
# design doc

## 機能
- yargs
  コマンドラインのインタフェースを作りやすく
- prompt
  対話側のスクリプト支援
- chalk
  色つけ
  その他、装飾関連はなんか探したい
- homeディレクトリ
  コマンドの内容を保存していく感じ
  home/.kniw/databases.json

## 使い方
- charactor
  キャラを登録する
  ローカルのhomeディレクトリに登録していくイメージ
  home/.kniw/charactor.json
  全部メモリに読み込んで、編集時には全とっかえする感じ
- party
  登録したキャラを使ってpartyを作ることができる
  作ったpartyはjsonファイルとして出力され、保存先を選べる
- battle
  作ったpartyを使って、バトルができる


## charactor
対話型で選択肢と、キャラ名を選んで入力していく。
ストレージ上で同一のキャラ名はNG
サブコマンドとして、list,describe,create,editなど

## party
キャラ名を選んでいってjsonを吐き出すためのコマンド
編集とかlistとかいるかな。
describe -file=<file>みたいな感じで、構築を確認するのは必要か
いや、これも編集があっていいし、なんなら、基本的に
home/.kniw/party.jsonに保存する形がいい。
で、party名も入力する必要がある。
list,describe,edit,create,export
describeはfileの中身を見る感じのこともできる

## battle
対戦なので本番
２つのpartyファイルを読み込んで対戦開始
キャラのwait turnを参照して次に順番が回ってきたやつの行動オプションを提示する。
アクションを実行すると、場、あるいはいずれかのキャラクターのHPなどが変化し、HPが0になると死亡
勝利条件は、基本的に殲滅か降参。


## モジュール

- 技
  効果を関数で表現する

- 武器
  技をもつ
  キャラに対するパラメータバフを持つ
  武器、防具、エレメントの3種類としたい

- キャラ
  武器を装備し、パラメータバフと技を利用可能になる
  攻撃力
  防御力
  HP
  wt



battleアクション時は、そのターンのキャラから技を選び、excute、あるいはdryrun関数の中で次の効果を得る。
dryrunの中には乱数や複数回行動がないが、excuteはあるイメージ

excuteの中で、キャラの状態に変化を及ぼし、その結果で、全体stateを更新していく

関数ごとにdryrunの仕様があるべきかなぁ
技関数の型はこんな感じかな

skill = actor => [actions]
action = (random, receiver) => receiver

dryrun関数は、複数あるアクションのうち、一つしか実行しないし、乱数が固定で1
乱数は0.9-1.1とかでいいんじゃないかな
あるいは0.95-1.05とか
ダメージ乱数と、命中乱数はあるべきだな
ダメージ乱数はダメージ幅を上下させるが、命中乱数は、その範囲内にその数がきたらヒットという感じかな

期待命中率は出すべきか。それはreceiverのパラメータも影響するはずなので、関数の戻り地にしないとだな



行動順については、ターンが終るごとに再計算する。
たとえばクイックとかもあるしな。
それで変わった順番でループの中でpopするイメージ

行動順の決定は、向こう数ターン。総勢24キャラがTOの最高だと思うので、25までは計算してやるか
ターンが経過したら、（=ループの次にきたら）先頭のキャラが消費したはずのwtを各キャラが消費。また、そのターンのアクションでwtに変化があればそれも再計算する




アクションは
技選択->対象選択(複数可)->ここで期待値が表示され、confirmするか選べる

技によって、対象をフィルタリングできるべきなので、技のフィルタリング関数も設けるべきだな。
対象がキャラなのか、場なのかとか、敵とか


バトルを前のターンに戻す機能はあったほうがよさそう。
間違えてconfirmする可能性もあるし。ただし1ターンだけでいい


battle logは以下の型
{
  action: {skill:"something", actor:"something"},
  state: {charactor01, charactor02, ...},
}
これの配列でいいか。配列のほうがjsは扱いやすいからな。nextを所有してもいいが、jsonで表現しきるのは大変j



charactorコマンドもpartyコマンドも、名前は一度作ったら変えられないようにしたい。
削除して作り直しはok

同じ名前のキャラがparty上にも登録されている場合、定義を変更したらpartyに反映するか否かは選べるようにしたい。

ディレクトリ構成はこうしたい
- .kniw
  - charactor
    - name01
    - name02
  - paty
    - name01
    - name02
  - battle
    - datetime.log
    - datetime.log


ターンの最初に、オプションコマンドは欲しい
だいたい、これらがあればそんなに難しくなく進められるはず。
- hpの一覧
- 特定のキャラのステータス表示
- mpの一覧


この装備とこの装備を組み合わせられないとか、partyメンバー数の上限とか、何らかのバリデーションはあってもよさそう。






こんなところかな。
これらを体系化してまとめて、その後でスケジュールを組んでいく感じ


