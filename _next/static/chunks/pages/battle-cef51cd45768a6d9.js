(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7156:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle",function(){return r(3989)}])},3989:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return eM}});var n={};r.r(n),r.d(n,{blindBull:function(){return m.q},blow:function(){return d.D},chop:function(){return p.p},clearCloud:function(){return x.D},coldFeet:function(){return y.v},concentration:function(){return j.c},copperBlue:function(){return w.x},crossFire:function(){return S.T},cumulonimbus:function(){return v.s},danceLeaves:function(){return I.n},dazzle:function(){return g.y},downRushing:function(){return C.e},eleciWave:function(){return V.Q},electoricBrain:function(){return b.n},electricShock:function(){return R.Z},fireWall:function(){return O.B},flameDigger:function(){return N._},flameFall:function(){return D.N},flashFlood:function(){return T.l},frostbite:function(){return _.f},ghostFire:function(){return E.d},gravelWall:function(){return k.c},guillotineOfGiant:function(){return L.H},gunStone:function(){return W.G},gunWater:function(){return z.v},hailstone:function(){return M.p},hardRain:function(){return H.u},heavyWind:function(){return A.m},higherBolt:function(){return G.W},iceSandwich:function(){return X.C},jammer:function(){return P.q},lightMeteor:function(){return F.P},mountFall:function(){return B.t},multiShot:function(){return K.j},overbear:function(){return $.m},paralysisScratch:function(){return q.r},paralysisShot:function(){return U.$},pitch:function(){return Z},push:function(){return Y.V},quench:function(){return Q.n},quick:function(){return tt.P},rockWave:function(){return te.j},saturnRing:function(){return tr.C},shot:function(){return tn.o},silent:function(){return ti.C},silentScratch:function(){return ta.d},silentShot:function(){return ts.T},slow:function(){return to.Y},smallHeat:function(){return tc.b},stab:function(){return tl.R},stickyRain:function(){return tu.f},stoneShell:function(){return th.v},stoneWeather:function(){return tf.c},swordDance:function(){return tm.f},thunder:function(){return td.o},tornade:function(){return tp.V},toxicScratch:function(){return tx.x},toxicShot:function(){return ty.c},waterCutter:function(){return tj.f},windEdge:function(){return tw.D}});var i=r(5893),a=r(7294),s=r(9332),o=r(7747),c=r(4e3),l=r(1604),u=r(4037),h=r(4201),f=r(4969),m=r(7510),d=r(2332),p=r(176),x=r(3185),y=r(6805),j=r(7113),w=r(667),S=r(340),v=r(6140),I=r(7453),g=r(3331),C=r(9170),V=r(3733),b=r(1538),R=r(1202),O=r(3181),N=r(6066),D=r(2274),T=r(4012),_=r(9969),E=r(113),k=r(1944),L=r(2131),W=r(9319),z=r(9502),M=r(1132),H=r(6516),A=r(5537),G=r(1137),X=r(6796),P=r(9246),F=r(9520),B=r(5311),K=r(2516),$=r(2144),q=r(1177),U=r(9053),J=r(9199);let Z={name:"pitch",label:"投げる",type:"SKILL_TO_CHARACTOR",action:J.Vo,directType:J.Vq,magicType:J.LB,baseDamage:60,mpConsumption:10,receiverCount:1,additionalWt:100,effectLength:5,getAccuracy:J.Tj,description:"投げる"};var Y=r(515),Q=r(4729),tt=r(8997),te=r(9918),tr=r(1089),tn=r(8036),ti=r(1293),ta=r(2252),ts=r(2211),to=r(7882),tc=r(4116),tl=r(5822),tu=r(9434),th=r(8323),tf=r(5319),tm=r(9205),td=r(6815),tp=r(9083),tx=r(2057),ty=r(4103),tj=r(2421),tw=r(5454),tS=r(6153);let tv=(0,tS.v)(n);var tI=r(6973),tg=r(3429),tC=r(7442);class tV{constructor(t,e,r){this.prop=t,this.value=e,this.message=r}}let tb=t=>{let{times:e,damage:r,accuracy:n}=t;return e>1||e<0?new tV("times",e,"timesの値は0から1です"):r>1||r<0?new tV("damage",r,"damageの値は0から1です"):n>1||n<0?new tV("accuracy",n,"accuracyの値は0から1です"):null},tR=()=>({times:Math.random(),damage:Math.random(),accuracy:Math.random()}),tO=()=>({times:1,damage:1,accuracy:1}),tN=[{name:"SUNNY",parcent:40},{name:"RAIN",parcent:30},{name:"FOGGY",parcent:10},{name:"STORM",parcent:10},{name:"SNOW",parcent:10}],tD=t=>{let e=tb(t);if(e instanceof tV)throw console.debug(e),Error(e.message);let r=100*t.accuracy,n=tN.reduce((t,e)=>{let r={...e};if(0===t.length)return[r];let n=t.slice(-1)[0];return r.parcent+=n.parcent,t.push(r),t},[]),i=n.find(t=>t.parcent>=r);return i?i.name:"SUNNY"};var tT=r(2457),t_=r(4168);let tE=t=>t.slice(-1)[0];class tk{constructor(t,e){this.charactor=t,this.message=e}}let tL="ONGOING",tW="HOME",tz="VISITOR",tM="DRAW",tH=t=>tE(t.turns),tA=t=>tE(t.turns).sortedCharactors[0],tG=t=>t.filter(t=>t.hp>0).sort((t,e)=>{let r=(0,tC.SR)(t),n=(0,tC.SR)(e),i=t.restWt-e.restWt;if(0!==i)return i;let a=r.AGI-n.AGI;if(0!==a)return a;let s=r.AVD-n.AVD;if(0!==s)return s;let o=t.hp-e.hp;if(0!==o)return o;let c=t.mp-e.mp;if(0!==c)return c;let l=t.statuses.length-e.statuses.length;return 0!==l?l:0}),tX=(t,e,r)=>{let n={name:e.name,charactors:e.charactors.map(t=>({...t,isVisitor:!1}))},i={name:r.name,charactors:r.charactors.map(t=>({...t,isVisitor:!0}))};return{title:t,home:n,visitor:i,turns:[],result:tL}},tP=(t,e,r)=>({datetime:e,action:{type:"TIME_PASSING",wt:0},sortedCharactors:tG([...t.home.charactors,...t.visitor.charactors]),field:{climate:tD(r)}}),tF=(t,e,r)=>{let n=tE(t.turns),i={datetime:r,action:{type:"DO_NOTHING",actor:e},sortedCharactors:n.sortedCharactors,field:n.field};return i.sortedCharactors=i.sortedCharactors.map(t=>{let r={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(r.restWt=(0,tC.SR)(t).WT),r}),i.sortedCharactors=tG(i.sortedCharactors),i},tB=t=>e=>{let r=t.find(t=>e.name===t.name);return r||e},tK=(t,e,r,n,i,a)=>{if("SKILL_TO_FIELD"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,t_.V)(tT.silent,e)&&r.magicType!==J.LB)throw Error("silent cannot do magic");if((0,t_.V)(tT.sleep,e)||(0,t_.V)(tT.paralysis,e)&&a.accuracy>.5)return tF(t,e,i);let s=tE(t.turns),o={datetime:i,action:{type:"DO_SKILL",actor:e,skill:r,receivers:n},sortedCharactors:s.sortedCharactors,field:s.field},c=n.map(t=>r.action(r,e,a,s.field,t));return o.sortedCharactors=o.sortedCharactors.map(tB(c)),o.sortedCharactors=o.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tC.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),o.sortedCharactors=tG(o.sortedCharactors),o},t$=(t,e,r,n,i)=>{if("SKILL_TO_CHARACTOR"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,t_.V)(tT.silent,e)&&r.magicType!==J.LB)throw Error("silent cannot do magic");if((0,t_.V)(tT.sleep,e)||(0,t_.V)(tT.paralysis,e)&&i.accuracy>.5)return tF(t,e,n);let a=tE(t.turns),s={datetime:n,action:{type:"DO_SKILL",actor:e,skill:r,receivers:[]},sortedCharactors:a.sortedCharactors,field:a.field};return s.field=r.action(r,e,i,a.field),s.sortedCharactors=s.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tC.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),s.sortedCharactors=tG(s.sortedCharactors),s},tq=(t,e,r)=>{let n=tE(t.turns);return{datetime:r,action:{type:"SURRENDER",actor:e},sortedCharactors:n.sortedCharactors,field:n.field}},tU=(t,e,r)=>{let n=(0,tC.BA)(t),i=n.reduce((t,n)=>n.wait(e,t,r),{...t,statuses:[...t.statuses.map(t=>({...t}))]}),a=(0,t_.V)(tT.quick,i)?1.5:(0,t_.V)(tT.slow,i)?.75:1;i.restWt=Math.max(i.restWt-e*a,0),(0,t_.V)(tT.acid,i)&&(i.hp=Math.max(i.hp-e/10,0)),i.statuses=i.statuses.map(t=>{let r=t.restWt-e;return{...t,restWt:r}}).filter(t=>t.restWt>0);let s=(0,tC.SR)(i);return i.mp=Math.min(i.mp+Math.floor(e/10),s.MaxMP),i},tJ=(t,e,r,n)=>{let i=tE(t.turns),a={datetime:r,action:{type:"TIME_PASSING",wt:e},sortedCharactors:i.sortedCharactors,field:{climate:tD(n)}};return a.sortedCharactors=a.sortedCharactors.map(t=>tU(t,e,n)),a},tZ=t=>{let e=tE(t.turns);if("SURRENDER"===e.action.type)return e.action.actor.isVisitor?tW:tz;let r=e.sortedCharactors.filter(t=>!t.isVisitor&&t.hp),n=e.sortedCharactors.filter(t=>t.isVisitor&&t.hp);return 0===r.length&&0===n.length?tM:r.length>0&&0===n.length?tW:0===r.length&&n.length>0?tz:tL},tY=l.z.object({type:l.z.literal("SURRENDER"),actor:tg.lo}),tQ=l.z.object({type:l.z.literal("DO_SKILL"),actor:tg.lo,skill:l.z.string(),receivers:l.z.array(tg.lo)}),t0=l.z.object({type:l.z.literal("DO_NOTHING"),actor:tg.lo}),t1=l.z.object({type:l.z.literal("TIME_PASSING"),wt:l.z.number().int()}),t3=l.z.discriminatedUnion("type",[tQ,t0,t1,tY]),t9=l.z.object({datetime:l.z.string().datetime({local:!0}),action:t3,sortedCharactors:l.z.array(tg.lo),field:l.z.object({climate:l.z.string()})}),t2=t=>"DO_SKILL"===t.type?{type:"DO_SKILL",actor:(0,tg.AM)(t.actor),skill:t.skill.name,receivers:t.receivers.map(tg.AM)}:"SURRENDER"===t.type?{type:"SURRENDER",actor:(0,tg.AM)(t.actor)}:"DO_NOTHING"===t.type?{type:"DO_NOTHING",actor:(0,tg.AM)(t.actor)}:{type:"TIME_PASSING",wt:t.wt},t7=t=>(0,h.Z)(t,"yyyy-MM-dd'T'HH:mm:ss"),t4=t=>({datetime:t7(t.datetime),action:t2(t.action),sortedCharactors:t.sortedCharactors.map(tg.AM),field:t.field}),t5=t=>{if("DO_SKILL"===t.type){let e=(0,tg.m$)(t.actor);if(e instanceof f.m||e instanceof tI.Xs)return e;if(!(0,tC.Ix)(e))return new tk(e,"actor(".concat(e.name,")にisVisitor propertyがありません"));let r=[];for(let e of t.receivers){let t=(0,tg.m$)(e);if(t instanceof f.m||t instanceof tI.Xs)return t;if(!(0,tC.Ix)(t))return new tk(t,"receiver(".concat(t.name,")にisVisitor propertyがありません"));r.push(t)}let n=tv.get(t.skill);return n?{type:"DO_SKILL",actor:e,skill:n,receivers:r}:new tI.Xs(t.skill,"skill","".concat(t.skill,"というskillは存在しません"))}if("SURRENDER"===t.type){let e=(0,tg.m$)(t.actor);return e instanceof f.m||e instanceof tI.Xs?e:(0,tC.Ix)(e)?{type:"SURRENDER",actor:e}:new tk(e,"actor(".concat(e.name,")にisVisitor propertyがありません"))}if("DO_NOTHING"===t.type){let e=(0,tg.m$)(t.actor);return e instanceof f.m||e instanceof tI.Xs?e:(0,tC.Ix)(e)?{type:"DO_NOTHING",actor:e}:new tk(e,"actor(".concat(e.name,")にisVisitor propertyがありません"))}return{type:"TIME_PASSING",wt:0+t.wt}},t6=t=>{let e=null;try{e=(0,u.Z)(t.datetime,"yyyy-MM-dd'T'HH:mm:ss",new Date)}catch(t){return new tI.$b(t,"日付が間違っています")}let r=t5(t.action);if(r instanceof f.m||r instanceof tI.Xs||r instanceof tk)return r;let n=[];for(let e of t.sortedCharactors){let t=(0,tg.m$)(e);if(t instanceof f.m||t instanceof tI.Xs)return t;if(!(0,tC.Ix)(t))return new tk(t,"charactor(".concat(t.name,")にisVisitor propertyがありません"));n.push(t)}let i={climate:t.field.climate};return{datetime:e,action:r,sortedCharactors:n,field:i}};var t8=r(4533),et=r(5618);let ee=l.z.object({title:l.z.string(),home:t8.ZL,visitor:t8.ZL,turns:l.z.array(t9),result:l.z.enum([tL,tW,tz,tM])});var er=r(8180);let en=(0,er.h)("battle",ee,t=>{let{title:e}=t,r=(0,t8.r7)(t.home);if(r instanceof f.m||r instanceof tI.Xs||r instanceof et.hi)return r;if(!(0,et.TD)(r))return new tk(r,"home party(".concat(r.name,")のcharactorにisVisitor propertyがありません"));let n=(0,t8.r7)(t.visitor);if(n instanceof f.m||n instanceof tI.Xs||n instanceof et.hi)return n;if(!(0,et.TD)(n))return new tk(n,"visitor party(".concat(n.name,")のcharactorにisVisitor propertyがありません"));let i=[];for(let e of t.turns){let t=t6(e);if(t instanceof f.m||t instanceof tI.Xs||t instanceof tI.$b||t instanceof tk)return t;i.push(t)}let{result:a}=t;return{title:e,home:r,visitor:n,turns:i,result:a}},t=>({title:t.title,home:(0,t8.KD)(t.home),visitor:(0,t8.KD)(t.visitor),turns:t.turns.map(t4),result:t.result}),"title");var ei=r(4271),ea=r(4670),es=r(1163),eo=r(1664),ec=r.n(eo),el=r(6312),eu=r(7536),eh=r(8020),ef=r(6529),em=r(1731),ed=r(2916),ep=r(1001),ex=r(8371),ey=r(2757),ej=r(5541),ew=r(3090),eS=r(1039),ev=r(1077);let eI="DO_NOTHING";class eg{constructor(t){this.message=t}}let eC=l.z.object({skillName:l.z.string().min(1),receiversWithIsVisitor:l.z.array(l.z.object({value:l.z.string().min(1)}))}),eV=t=>({value:"".concat(t.name,"__").concat((0,tC.oR)(t.isVisitor)),label:"".concat(t.name,"(").concat((0,tC.oR)(t.isVisitor),")")}),eb=(t,e)=>{let r=t.match(/^(.*)__(HOME|VISITOR)$/);if(!r)throw Error("no match");let n=r[1];if(!n)throw Error("no name");let i=r[2];if("HOME"!==i&&"VISITOR"!==i)throw Error("isVisitorStr must be HOME or VISITOR. (".concat(i,")"));let a="VISITOR"===i,s=e.find(t=>t.name===n&&t.isVisitor===a);return s||new tI.Xs(n,"charactor","".concat(n,"というcharactorは存在しません"))},eR=(t,e)=>{let{skillName:r}=t;if(r===eI)return null;let n=tv.get(r);if(!n)return new tI.Xs(r,"skill","".concat(r,"というskillは存在しません"));let i=new Set(t.receiversWithIsVisitor.map(t=>t.value));if(i.size!==t.receiversWithIsVisitor.length)return new eg("同じキャラクターを複数回えらべません");let a=[];for(let r of t.receiversWithIsVisitor){let t=eb(r.value,e);if(t instanceof tI.Xs)return t;a.push(t)}return{skill:n,receivers:a}},eO=t=>{let{battle:e}=t,r="".concat(e.home.name,"(HOME) vs ").concat(e.visitor.name,"(VISITOR)");switch(e.result){case tW:return(0,i.jsx)(c.x,{children:"".concat(r," HOME側の勝利")});case tz:return(0,i.jsx)(c.x,{children:"".concat(r," VISITOR側の勝利")});case tM:return(0,i.jsx)(c.x,{children:"".concat(r," 引き分け")});default:return(0,i.jsx)(c.x,{children:r})}},eN=t=>{let{battle:e,actor:r,lastTurn:n,skill:s,index:c,getValues:l,register:u}=t,h="receiversWithIsVisitor.".concat(c,".value"),[f,m]=(0,a.useState)(null);if(!s)return null;let d=n.sortedCharactors.map(eV);return(0,i.jsxs)(o.xu,{children:[(0,i.jsxs)(eh.NI,{children:[(0,i.jsx)(ef.l,{htmlFor:h,children:"receiver"}),(0,i.jsx)(em.P,{...u(h,{onBlur:()=>{if(!s){m(null);return}let t=l(h),i=eb(t,n.sortedCharactors);if(i instanceof tI.Xs){m(null);return}let a=tK(e,r,s,[i],new Date,tO()),o=a.sortedCharactors.find(t=>t.isVisitor===i.isVisitor&&t.name===i.name);o||m("".concat(i.name," will dead")),m(o||null)}}),placeholder:"receiver",children:d.map(t=>(0,i.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))})]}),(0,i.jsx)(o.xu,{children:f&&("string"==typeof f?f:(0,i.jsx)(ev.i,{charactor:f}))})]})},eD=t=>{let{battle:e,actor:r,repository:n}=t,a=async()=>{if(window.confirm("降参してもよいですか？")){let t=tq(e,r,new Date);e.turns.push(t),await n.save({...e,result:r.isVisitor?tW:tz})}};return(0,i.jsx)(ed.z,{type:"button",onClick:a,children:"降参"})},eT=t=>{let{actor:e,replace:r,getValues:n,register:a,errors:s}=t,o=(0,tC.SM)(e),c=o.filter(t=>t.mpConsumption<=e.mp).filter(t=>!(0,t_.V)(tT.silent,e)||t.magicType===J.LB).map(t=>({value:t.name,label:t.name}));return c.push({value:eI,label:"何もしない"}),(0,i.jsxs)(eh.NI,{isInvalid:!!s.skillName,children:[(0,i.jsx)(ef.l,{htmlFor:"skill",children:"skill"}),(0,i.jsx)(em.P,{...a("skillName",{onBlur:()=>{let t=n("skillName");if(t===eI){r([]);return}let e=tv.get(t);if(!e||!e.receiverCount){r([]);return}let i=Array(e.receiverCount).fill("");r(i)}}),placeholder:"skill",children:c.map(t=>(0,i.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))}),(0,i.jsx)(ep.J1,{children:!!s.skillName&&s.skillName.message})]})},e_=async(t,e,r,n)=>{if(null===n)e.turns.push(tF(e,r,new Date));else{let t=n.skill,i="SKILL_TO_FIELD"===t.type?t$(e,r,t,new Date,tR()):tK(e,r,t,n.receivers,new Date,tR());e.turns.push(i)}if(e.result=tZ(e),e.result!==tL){await t.save(e);return}let i=tA(e);if(e.turns.push(tJ(e,i.restWt,new Date,tR())),e.result=tZ(e),e.result!==tL){await t.save(e);return}for(;(0,t_.V)(tT.sleep,i);)if(e.turns.push(tF(e,i,new Date)),e.result=tZ(e),e.result!==tL||(i=tA(e),e.turns.push(tJ(e,i.restWt,new Date,tR())),e.result=tZ(e),e.result!==tL)){await t.save(e);return}await t.save(e)},eE=t=>{let{battle:e,repository:r}=t,n=tH(e),s=tA(e),{handleSubmit:l,register:u,getValues:h,formState:{errors:f,isSubmitting:m},control:d}=(0,eu.cI)({resolver:(0,el.F)(eC)}),{fields:p,replace:x}=(0,eu.Dq)({control:d,name:"receiversWithIsVisitor"}),[y,j]=(0,a.useState)(""),w=async t=>{let i=eR(t,n.sortedCharactors);if(i instanceof tI.Xs){j("入力してください");return}if(i instanceof eg){j(i.message);return}window.confirm("実行していいですか？")&&(x([]),await e_(r,e,s,i))},S=s.isVisitor?(0,i.jsx)(ex.Vp,{children:"VISITOR"}):(0,i.jsx)(ex.Vp,{children:"HOME"});return(0,i.jsxs)(o.xu,{p:4,children:[(0,i.jsx)(ec(),{href:{pathname:"battle"},children:(0,i.jsx)("a",{children:"戻る"})}),(0,i.jsx)(c.x,{children:"This is the battle page"}),e.result!==tL&&(0,i.jsx)(ed.z,{type:"button",onClick:()=>r.exportJson(e,""),children:"Export"}),(0,i.jsx)(eO,{battle:e}),e.result===tL&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("form",{onSubmit:l(w),children:[y&&(0,i.jsx)(ep.J1,{children:y}),e.result===tL&&(0,i.jsx)(eD,{battle:e,actor:s,repository:r}),(0,i.jsxs)(o.xu,{as:"dl",children:[(0,i.jsx)(ey.X,{as:"dt",children:"battle title"}),(0,i.jsx)(c.x,{as:"dd",children:e.title})]}),(0,i.jsxs)(c.x,{children:["".concat(s.name,"のターン"),S]}),(0,i.jsx)(eT,{actor:s,getValues:h,register:u,errors:f,replace:x}),(0,i.jsx)(ej.aV,{children:p.map((t,r)=>(0,i.jsx)(ej.HC,{children:(0,i.jsx)(eN,{battle:e,actor:s,lastTurn:n,skill:tv.get(h("skillName")),getValues:h,register:u,index:r})},"receiversWithIsVisitor.".concat(r)))}),(0,i.jsx)(ed.z,{colorScheme:"teal",isLoading:m,type:"submit",children:"実行"})]}),(0,i.jsx)(o.xu,{children:(0,i.jsx)(ej.aV,{children:n.sortedCharactors.map(t=>(0,i.jsx)(ej.HC,{children:(0,i.jsx)(ev.i,{charactor:t})},"CharactorDetail-".concat(t.name,"-").concat((0,tC.oR)(t.isVisitor))))})})]})]})},ek=t=>{let{repository:e,battleTitle:r}=t,n=(0,eS.useLiveQuery)(()=>e.get(r),[r]);return n instanceof f.m||n instanceof tI.Xs||n instanceof et.hi||n instanceof tI.$b||n instanceof tk?(0,i.jsxs)(o.xu,{children:[(0,i.jsx)(c.x,{children:n.message}),(0,i.jsx)(ec(),{href:{pathname:"battle"},children:(0,i.jsx)("a",{children:"戻る"})})]}):n?(0,i.jsx)(eE,{battle:n,repository:e}):(0,i.jsxs)(o.xu,{children:[(0,i.jsx)(ec(),{href:{pathname:"battle"},children:(0,i.jsx)("a",{children:"戻る"})}),(0,i.jsx)(c.x,{children:"".concat(r,"というbattleは見つかりません")})]})},eL=t=>{let{type:e,party:r,setParty:n,repository:a}=t,s=async()=>{let t=await a.importJson("");if(!t){window.alert("patryがありません");return}if(t instanceof tI.$b||t instanceof f.m||t instanceof tI.Xs||t instanceof et.hi){window.alert(t.message);return}n(t)};return(0,i.jsxs)(o.xu,{children:[r&&(0,i.jsx)(c.x,{children:"".concat(e," Party: ").concat(r.name)}),(0,i.jsx)(ed.z,{type:"button",onClick:s,children:"Select ".concat(e," Party")})]})},eW=t=>{let{battleRepository:e,partyRepository:r}=t,n=(0,es.useRouter)(),[s,l]=(0,a.useState)(""),{handleSubmit:u,register:h,formState:{errors:f,isSubmitting:m}}=(0,eu.cI)(),[d,p]=(0,a.useState)(null),[x,y]=(0,a.useState)(null),j=async t=>{let r=[],{title:i}=t;if(!i){r.push("titleを入力してください");return}if(!d){r.push("home partyを入力してください");return}if(!x){r.push("visitor partyを入力してください");return}if(r.length>0){l(r.join("\n"));return}let a=tX(i,d,x),s=tP(a,new Date,tR());a.turns.push(s);let o=tA(a);a.turns.push(tJ(a,o.restWt,new Date,tR())),await e.save(a),await n.push({pathname:"battle",query:{title:a.title}})};return(0,i.jsxs)(o.xu,{p:4,children:[(0,i.jsx)(ec(),{href:{pathname:"battle"},children:(0,i.jsx)("a",{children:"戻る"})}),(0,i.jsx)(c.x,{children:"This is the battle page"}),(0,i.jsxs)("form",{onSubmit:u(j),children:[s&&(0,i.jsx)(ep.J1,{children:s}),(0,i.jsxs)(eh.NI,{isInvalid:!!f.title,children:[(0,i.jsx)(ef.l,{htmlFor:"title",children:"title"}),(0,i.jsx)(ew.I,{id:"title",placeholder:"title",...h("title")}),(0,i.jsx)(ep.J1,{children:f.title&&f.title.message})]}),(0,i.jsx)(eL,{type:"HOME",party:d,setParty:p,repository:r}),(0,i.jsx)(eL,{type:"VISITOR",party:x,setParty:y,repository:r}),(0,i.jsx)(ed.z,{colorScheme:"teal",isLoading:m,type:"submit",children:"Start Battle"})]})]})},ez=t=>{let{repository:e}=t,r=(0,eS.useLiveQuery)(()=>e.list(),[]);return(0,i.jsxs)(o.xu,{children:[(0,i.jsx)(ec(),{href:{pathname:"/"},children:(0,i.jsx)("a",{children:"戻る"})}),(0,i.jsx)(o.xu,{children:(0,i.jsxs)(ej.aV,{children:[(0,i.jsx)(ej.HC,{children:(0,i.jsx)(ec(),{href:{pathname:"battle",query:{title:"__new"}},children:(0,i.jsx)("a",{children:"新しく作る"})})},"battle-new"),r&&r.map((t,e)=>(0,i.jsx)(ej.HC,{children:(0,i.jsx)(ec(),{href:{pathname:"battle",query:{title:t}},children:(0,i.jsx)("a",{children:t})})},"battle-".concat(e)))]})})]})};var eM=()=>{let t=(0,s.useSearchParams)(),e=t.get("title"),[r,n]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{let t=await (0,ea.a)(),e=await en(t),r=await (0,ei.h4)(t);n({battle:e,party:r})})()},[]),r)?e?"__new"===e?(0,i.jsx)(eW,{battleRepository:r.battle,partyRepository:r.party}):(0,i.jsx)(ek,{battleTitle:e,repository:r.battle}):(0,i.jsx)(ez,{repository:r.battle}):(0,i.jsx)(o.xu,{children:(0,i.jsx)(c.x,{children:"loading..."})})}}},function(t){t.O(0,[905,198,348,382,774,888,179],function(){return t(t.s=7156)}),_N_E=t.O()}]);