(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{6698:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/party",function(){return a(1525)}])},1525:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return $}});var t=a(5893),r=a(7294),s=a(9332),i=a(7747),c=a(4e3),o=a(4271),l=a(4670),h=a(1163),m=a(1664),u=a.n(m),x=a(1077),p=a(6312),d=a(7536),f=a(1001),j=a(2757),g=a(8020),y=a(6529),w=a(3090),b=a(5541),_=a(2916),z=a(1039),C=a(1604),X=a(6973),v=a(4969),k=a(7442),S=a(524);let E=C.z.object({name:C.z.string().min(1),race:C.z.string().min(1),blessing:C.z.string().min(1),clothing:C.z.string().min(1),weapon:C.z.string().min(1)}),N=e=>({name:e.name,race:e.race.name,blessing:e.blessing.name,clothing:e.clothing.name,weapon:e.weapon.name}),H=e=>{let{name:n}=e,a=S.CJ.get(e.race);if(!a)return new X.Xs(e.race,"race","".concat(e.race,"という種族は存在しません"));let t=S.zv.get(e.blessing);if(!t)return new X.Xs(e.blessing,"blessing","".concat(e.blessing,"という祝福は存在しません"));let r=S.bY.get(e.clothing);if(!r)return new X.Xs(e.clothing,"clothing","".concat(e.clothing,"という装備は存在しません"));let s=S.C.get(e.weapon);if(!s)return new X.Xs(e.weapon,"weapon","".concat(e.weapon,"という武器は存在しません"));let i=(0,k.Gu)(n,a,t,r,s);if(i instanceof v.m)return i;let c={name:n,race:a,blessing:t,clothing:r,weapon:s,statuses:[],hp:0,mp:0,restWt:0},o=(0,k.SR)(c);return c.hp=o.MaxHP,c.restWt=o.WT,c};var I=a(5618);let J=C.z.object({name:C.z.string().min(1),charactors:C.z.array(E)}),q=e=>({name:e.name,charactors:e.charactors.map(N)}),F=e=>{let{name:n}=e,a=[];for(let n of e.charactors){let e=H(n);if(e instanceof X.Xs||e instanceof v.m)return e;a.push(e)}let t=(0,I.Gu)(n,a);return t instanceof I.hi?t:{name:n,charactors:a}},P=(e,n)=>async a=>{let t=F(a);if(t instanceof X.Xs||t instanceof v.m||t instanceof I.hi)return t;if(n){let n=await e.list();if(n.includes(t.name))return new X.KC(t.name,"party","".concat(t.name,"というpartyは既に存在します"))}return await e.save(t),null},T=e=>{let{exist:n,partyForm:a,inoutButton:s,repository:o}=e,l=(0,h.useRouter)(),{handleSubmit:m,register:z,getValues:C,formState:{errors:k,isSubmitting:S},control:E}=(0,d.cI)({resolver:(0,p.F)(J),defaultValues:a}),{fields:N,append:H,remove:q}=(0,d.Dq)({control:E,name:"charactors"}),[F,T]=(0,r.useState)({error:!1,message:""}),V=async e=>{let a=await P(o,!n)(e);a instanceof X.Xs||a instanceof v.m||a instanceof X.$b||a instanceof I.hi||a instanceof X.KC?T({error:!0,message:a.message}):n?T({error:!1,message:"保存しました"}):await l.push({pathname:"party",query:{name:e.name}})},L=async e=>{window.confirm("削除してもよいですか？")&&(await o.remove(e),await l.push({pathname:"party"}))};return(0,t.jsxs)(i.xu,{p:4,children:[(0,t.jsx)(u(),{href:{pathname:"party"},children:(0,t.jsx)("a",{children:"戻る"})}),(0,t.jsx)(c.x,{children:"This is the party page"}),s,(0,t.jsxs)("form",{onSubmit:m(V),children:[F.message&&(F.error?(0,t.jsx)(f.J1,{children:F.message}):(0,t.jsx)(c.x,{children:F.message})),n?(0,t.jsxs)(i.xu,{as:"dl",children:[(0,t.jsx)(j.X,{as:"dt",children:"party name"}),(0,t.jsx)(c.x,{as:"dd",children:a.name})]}):(0,t.jsxs)(g.NI,{isInvalid:!!k.name,children:[(0,t.jsx)(y.l,{htmlFor:"name",children:"name"}),(0,t.jsx)(w.I,{id:"name",placeholder:"name",...z("name")}),(0,t.jsx)(f.J1,{children:k.name&&k.name.message})]}),(0,t.jsx)(b.aV,{children:N.map((e,n)=>(0,t.jsx)(b.HC,{children:(0,t.jsx)(x.g,{register:z,getValues:C,remove:q,errors:k,index:n})},"charactor-".concat(n)))}),(0,t.jsx)(_.z,{type:"button",onClick:()=>H({name:"",race:"",blessing:"",clothing:"",weapon:""}),children:"Hire"}),(0,t.jsx)(_.z,{colorScheme:"teal",isLoading:S,type:"submit",children:n?"Change":"Create"}),n&&(0,t.jsx)(_.z,{type:"button",onClick:()=>L(a.name),children:"Dismiss"})]})]})},V=e=>{let{repository:n,partyName:a}=e,r=(0,z.useLiveQuery)(()=>n.get(a),[a]);return r instanceof v.m||r instanceof X.Xs||r instanceof I.hi||r instanceof X.$b?(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(c.x,{children:r.message}),(0,t.jsx)(u(),{href:{pathname:"party"},children:(0,t.jsx)("a",{children:"戻る"})})]}):r?(0,t.jsx)(T,{exist:!0,partyForm:q(r),repository:n,inoutButton:(0,t.jsx)(_.z,{type:"button",onClick:()=>n.exportJson(r,""),children:"Export"})}):(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(c.x,{children:"".concat(a,"というpartyは見つかりません")}),(0,t.jsx)(u(),{href:{pathname:"party"},children:(0,t.jsx)("a",{children:"戻る"})})]})},L=e=>{let{repository:n}=e,[a,s]=(0,r.useState)({name:"",charactors:[]}),i=async()=>{if(!window.confirm("取り込むと入力したデータが削除されますがよいですか？"))return;let e=await n.importJson("");if(!e){window.alert("partyがありません");return}if(e instanceof X.$b||e instanceof v.m||e instanceof X.Xs||e instanceof I.hi){window.alert(e.message);return}s(q(e))};return(0,t.jsx)(T,{exist:!1,partyForm:a,repository:n,inoutButton:(0,t.jsx)(_.z,{type:"button",onClick:i,children:"Import"})})},W=e=>{let{repository:n}=e,a=(0,z.useLiveQuery)(()=>n.list(),[]);return(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(u(),{href:{pathname:"/"},children:(0,t.jsx)("a",{children:"戻る"})}),(0,t.jsx)(i.xu,{children:(0,t.jsxs)(b.aV,{children:[(0,t.jsx)(b.HC,{children:(0,t.jsx)(u(),{href:{pathname:"party",query:{name:"__new"}},children:(0,t.jsx)("a",{children:"新しく作る"})})},"party-new"),a&&a.map((e,n)=>(0,t.jsx)(b.HC,{children:(0,t.jsx)(u(),{href:{pathname:"party",query:{name:e}},children:(0,t.jsx)("a",{children:e})})},"party-".concat(n)))]})})]})};var $=()=>{let e=(0,s.useSearchParams)(),n=e.get("name"),[a,h]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{let e=await (0,l.a)(),n=await (0,o.h4)(e);h(n)})()},[]),a)?n?"__new"===n?(0,t.jsx)(L,{repository:a}):(0,t.jsx)(V,{partyName:n,repository:a}):(0,t.jsx)(W,{repository:a}):(0,t.jsx)(i.xu,{children:(0,t.jsx)(c.x,{children:"loading..."})})}}},function(e){e.O(0,[905,198,382,774,888,179],function(){return e(e.s=6698)}),_N_E=e.O()}]);