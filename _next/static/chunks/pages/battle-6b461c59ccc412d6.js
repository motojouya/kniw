(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7156:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle",function(){return r(3989)}])},3989:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return eG}});var n={};r.r(n),r.d(n,{blindBull:function(){return f.q},blow:function(){return p.D},chop:function(){return m.p},clearCloud:function(){return d.D},coldFeet:function(){return y.v},concentration:function(){return x.c},copperBlue:function(){return j.x},crossFire:function(){return w.T},cumulonimbus:function(){return v.s},danceLeaves:function(){return g.n},dazzle:function(){return b.y},downRushing:function(){return S.e},eleciWave:function(){return I.Q},electoricBrain:function(){return V.n},electricShock:function(){return C.Z},fireWall:function(){return O.B},flameDigger:function(){return N._},flameFall:function(){return R.N},flashFlood:function(){return D.l},frostbite:function(){return T.f},ghostFire:function(){return E.d},gravelWall:function(){return _.c},guillotineOfGiant:function(){return k.H},gunStone:function(){return L.G},gunWater:function(){return W.v},hailstone:function(){return M.p},hardRain:function(){return H.u},heavyWind:function(){return A.m},higherBolt:function(){return $.W},iceSandwich:function(){return q.C},jammer:function(){return G.q},lightMeteor:function(){return X.P},mountFall:function(){return P.t},multiShot:function(){return B.j},overbear:function(){return K.m},paralysisScratch:function(){return F.r},paralysisShot:function(){return J.$},pitch:function(){return z},push:function(){return Z.V},quench:function(){return Y.n},quick:function(){return Q.P},rockWave:function(){return tt.j},saturnRing:function(){return te.C},shot:function(){return tr.o},silent:function(){return tn.C},silentScratch:function(){return ts.d},silentShot:function(){return ti.T},slow:function(){return ta.Y},smallHeat:function(){return to.b},stab:function(){return tc.R},stickyRain:function(){return tl.f},stoneShell:function(){return tu.v},stoneWeather:function(){return th.c},swordDance:function(){return tf.f},thunder:function(){return tp.o},tornade:function(){return tm.V},toxicScratch:function(){return td.x},toxicShot:function(){return ty.c},waterCutter:function(){return tx.f},windEdge:function(){return tj.D}});var s=r(5893),i=r(7294),a=r(9332),o=r(7747),c=r(4e3),l=r(562),u=r(7808),h=r(4969),f=r(7510),p=r(2332),m=r(176),d=r(3185),y=r(6805),x=r(7113),j=r(667),w=r(340),v=r(6140),g=r(7453),b=r(3331),S=r(9170),I=r(3733),V=r(1538),C=r(1202),O=r(3181),N=r(6066),R=r(2274),D=r(4012),T=r(9969),E=r(113),_=r(1944),k=r(2131),L=r(9319),W=r(652),M=r(1132),H=r(6516),A=r(5537),$=r(1137),q=r(6796),G=r(9246),X=r(9520),P=r(5311),B=r(2516),K=r(2144),F=r(1177),J=r(9053),U=r(9199);let z={name:"pitch",label:"投げる",type:"SKILL_TO_CHARACTOR",action:U.Vo,directType:U.Vq,magicType:U.LB,baseDamage:60,mpConsumption:10,receiverCount:1,additionalWt:100,effectLength:5,getAccuracy:U.Tj,description:"投げる"};var Z=r(515),Y=r(4729),Q=r(8997),tt=r(9918),te=r(1089),tr=r(8036),tn=r(1293),ts=r(2252),ti=r(2211),ta=r(7882),to=r(4116),tc=r(5822),tl=r(7171),tu=r(8323),th=r(5319),tf=r(9205),tp=r(6815),tm=r(9083),td=r(2057),ty=r(4103),tx=r(2421),tj=r(5454);let tw=t=>n[t];Object.keys(n),Object.values(n);var tv=r(8227),tg=r(3429),tb=r(7442);class tS{constructor(t,e,r){this.prop=t,this.value=e,this.message=r}}let tI=t=>{let{times:e,damage:r,accuracy:n}=t;return e>1||e<0?new tS("times",e,"timesの値は0から1です"):r>1||r<0?new tS("damage",r,"damageの値は0から1です"):n>1||n<0?new tS("accuracy",n,"accuracyの値は0から1です"):null},tV=()=>({times:Math.random(),damage:Math.random(),accuracy:Math.random()}),tC=()=>({times:1,damage:1,accuracy:1}),tO=[{name:"SUNNY",parcent:40},{name:"RAIN",parcent:30},{name:"FOGGY",parcent:10},{name:"STORM",parcent:10},{name:"SNOW",parcent:10}],tN=t=>{let e=tI(t);if(e instanceof tS)throw console.debug(e),Error(e.message);let r=100*t.accuracy,n=tO.reduce((t,e)=>{let r={...e};if(0===t.length)return[r];let n=t.slice(-1)[0];return r.parcent+=n.parcent,t.push(r),t},[]),s=n.find(t=>t.parcent>=r);return s?s.name:"SUNNY"};var tR=r(2457),tD=r(4168);let tT=t=>t.slice(-1)[0];class tE{constructor(t,e){this.charactor=t,this.message=e}}let t_="ONGOING",tk="HOME",tL="VISITOR",tW="DRAW",tM=t=>tT(t.turns),tH=t=>tT(t.turns).sortedCharactors[0],tA=t=>t.filter(t=>t.hp>0).sort((t,e)=>{let r=(0,tb.SR)(t),n=(0,tb.SR)(e),s=t.restWt-e.restWt;if(0!==s)return s;let i=r.AGI-n.AGI;if(0!==i)return i;let a=r.AVD-n.AVD;if(0!==a)return a;let o=t.hp-e.hp;if(0!==o)return o;let c=t.mp-e.mp;if(0!==c)return c;let l=t.statuses.length-e.statuses.length;return 0!==l?l:0}),t$=(t,e,r)=>{let n={name:e.name,charactors:e.charactors.map(t=>({...t,isVisitor:!1}))},s={name:r.name,charactors:r.charactors.map(t=>({...t,isVisitor:!0}))};return{title:t,home:n,visitor:s,turns:[],result:t_}},tq=(t,e,r)=>({datetime:e,action:{type:"TIME_PASSING",wt:0},sortedCharactors:tA([...t.home.charactors,...t.visitor.charactors]),field:{climate:tN(r)}}),tG=(t,e,r)=>{let n=tT(t.turns),s={datetime:r,action:{type:"DO_NOTHING",actor:e},sortedCharactors:n.sortedCharactors,field:n.field};return s.sortedCharactors=s.sortedCharactors.map(t=>{let r={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(r.restWt=(0,tb.SR)(t).WT),r}),s.sortedCharactors=tA(s.sortedCharactors),s},tX=t=>e=>{let r=t.find(t=>e.name===t.name);return r||e},tP=(t,e,r,n,s,i)=>{if("SKILL_TO_FIELD"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,tD.V)(tR.silent,e)&&r.magicType!==U.LB)throw Error("silent cannot do magic");if((0,tD.V)(tR.sleep,e)||(0,tD.V)(tR.paralysis,e)&&i.accuracy>.5)return tG(t,e,s);let a=tT(t.turns),o={datetime:s,action:{type:"DO_SKILL",actor:e,skill:r,receivers:n},sortedCharactors:a.sortedCharactors,field:a.field},c=n.map(t=>r.action(r,e,i,a.field,t));return o.sortedCharactors=o.sortedCharactors.map(tX(c)),o.sortedCharactors=o.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tb.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),o.sortedCharactors=tA(o.sortedCharactors),o},tB=(t,e,r,n,s)=>{if("SKILL_TO_CHARACTOR"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,tD.V)(tR.silent,e)&&r.magicType!==U.LB)throw Error("silent cannot do magic");if((0,tD.V)(tR.sleep,e)||(0,tD.V)(tR.paralysis,e)&&s.accuracy>.5)return tG(t,e,n);let i=tT(t.turns),a={datetime:n,action:{type:"DO_SKILL",actor:e,skill:r,receivers:[]},sortedCharactors:i.sortedCharactors,field:i.field};return a.field=r.action(r,e,s,i.field),a.sortedCharactors=a.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tb.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),a.sortedCharactors=tA(a.sortedCharactors),a},tK=(t,e,r)=>{let n=tT(t.turns);return{datetime:r,action:{type:"SURRENDER",actor:e},sortedCharactors:n.sortedCharactors,field:n.field}},tF=(t,e,r)=>{let n=(0,tb.BA)(t),s=n.reduce((t,n)=>n.wait(e,t,r),{...t,statuses:[...t.statuses.map(t=>({...t}))]}),i=(0,tD.V)(tR.quick,s)?1.5:(0,tD.V)(tR.slow,s)?.75:1;s.restWt=Math.max(s.restWt-e*i,0),(0,tD.V)(tR.acid,s)&&(s.hp=Math.max(s.hp-e/10,0)),s.statuses=s.statuses.map(t=>{let r=t.restWt-e;return{...t,restWt:r}}).filter(t=>t.restWt>0);let a=(0,tb.SR)(s);return s.mp=Math.min(s.mp+Math.floor(e/10),a.MaxMP),s},tJ=(t,e,r,n)=>{let s=tT(t.turns),i={datetime:r,action:{type:"TIME_PASSING",wt:e},sortedCharactors:s.sortedCharactors,field:{climate:tN(n)}};return i.sortedCharactors=i.sortedCharactors.map(t=>tF(t,e,n)),i},tU=t=>{let e=tT(t.turns);if("SURRENDER"===e.action.type)return e.action.actor.isVisitor?tk:tL;let r=e.sortedCharactors.filter(t=>!t.isVisitor&&t.hp),n=e.sortedCharactors.filter(t=>t.isVisitor&&t.hp);return 0===r.length&&0===n.length?tW:r.length>0&&0===n.length?tk:0===r.length&&n.length>0?tL:t_},tz={type:"object",properties:{type:{const:"SURRENDER"},actor:tg.lo},required:["type","actor"]},tZ={type:"object",properties:{type:{const:"DO_SKILL"},actor:tg.lo,skill:{type:"string"},receivers:{type:"array",items:tg.lo}},required:["type","actor","skill","receivers"]},tY={type:"object",properties:{type:{const:"DO_NOTHING"},actor:tg.lo},required:["type","actor"]},tQ={anyOf:[tZ,tY,{type:"object",properties:{type:{const:"TIME_PASSING"},wt:{type:"integer"}},required:["type","wt"]},tz]},t0={type:"object",properties:{datetime:{type:"string",format:"date-time"},action:tQ,sortedCharactors:{type:"array",items:tg.lo},field:{type:"object",properties:{climate:{type:"string"}},required:["climate"]}},required:["datetime","action","sortedCharactors","field"]},t1=t=>"DO_SKILL"===t.type?{type:"DO_SKILL",actor:(0,tg.AM)(t.actor),skill:t.skill.name,receivers:t.receivers.map(tg.AM)}:"SURRENDER"===t.type?{type:"SURRENDER",actor:(0,tg.AM)(t.actor)}:"DO_NOTHING"===t.type?{type:"DO_NOTHING",actor:(0,tg.AM)(t.actor)}:{type:"TIME_PASSING",wt:t.wt},t3=t=>({datetime:t.datetime.toLocaleString("ja-JP",{timeZone:"Asia/Tokyo"}),action:t1(t.action),sortedCharactors:t.sortedCharactors.map(tg.AM),field:t.field}),t7=t=>{let e=(0,l.y)(),r=e(tQ);if(!r(t)){let{errors:t}=r;return console.debug(t),new tv.$b(t,"actionのjsonデータではありません")}if("DO_SKILL"===t.type){let e=(0,tg.m$)(t.actor);if(e instanceof h.m||e instanceof tv.Xs||e instanceof tv.$b)return e;if(!(0,tb.Ix)(e))return new tE(e,"actor(".concat(e.name,")にisVisitor propertyがありません"));let r=[];for(let e of t.receivers){let t=(0,tg.m$)(e);if(t instanceof h.m||t instanceof tv.Xs||t instanceof tv.$b)return t;if(!(0,tb.Ix)(t))return new tE(t,"receiver(".concat(t.name,")にisVisitor propertyがありません"));r.push(t)}let n=tw(t.skill);return n?{type:"DO_SKILL",actor:e,skill:n,receivers:r}:new tv.Xs(t.skill,"skill","".concat(t.skill,"というskillは存在しません"))}if("SURRENDER"===t.type){let e=(0,tg.m$)(t.actor);return e instanceof h.m||e instanceof tv.Xs||e instanceof tv.$b?e:(0,tb.Ix)(e)?{type:"SURRENDER",actor:e}:new tE(e,"actor(".concat(e.name,")にisVisitor propertyがありません"))}if("DO_NOTHING"===t.type){let e=(0,tg.m$)(t.actor);return e instanceof h.m||e instanceof tv.Xs||e instanceof tv.$b?e:(0,tb.Ix)(e)?{type:"DO_NOTHING",actor:e}:new tE(e,"actor(".concat(e.name,")にisVisitor propertyがありません"))}return{type:"TIME_PASSING",wt:0+t.wt}},t2=t=>{let e=(0,l.y)(),r=e(t0);if(!r(t)){let{errors:t}=r;return console.debug(t),new tv.$b(t,"turnのjsonデータではありません")}let n=null;try{n=(0,u.Z)(t.datetime,"yyyy-MM-dd'T'HH:mm:ss",new Date)}catch(t){return new tv.$b(t,"日付が間違っています")}let s=t7(t.action);if(s instanceof h.m||s instanceof tv.Xs||s instanceof tv.$b||s instanceof tE)return s;let i=[];for(let e of t.sortedCharactors){let t=(0,tg.m$)(e);if(t instanceof h.m||t instanceof tv.Xs||t instanceof tv.$b)return t;if(!(0,tb.Ix)(t))return new tE(t,"charactor(".concat(t.name,")にisVisitor propertyがありません"));i.push(t)}let a={climate:t.field.climate};return{datetime:n,action:s,sortedCharactors:i,field:a}};var t5=r(4533),t9=r(5618);let t6={type:"object",properties:{title:{type:"string"},home:t5.ZL,visitor:t5.ZL,turns:{type:"array",items:t0},result:{enum:[t_,tk,tL,tW]}},required:["title","home","visitor","turns","result"]},t4=t=>({title:t.title,home:(0,t5.KD)(t.home),visitor:(0,t5.KD)(t.visitor),turns:t.turns.map(t3),result:t.result}),t8=t=>{let e=(0,l.y)(),r=e(t6);if(!r(t)){let{errors:t}=r;return console.debug(t),new tv.$b(t,"battleのjsonデータではありません")}let{title:n}=t,s=(0,t5.r7)(t.home);if(s instanceof h.m||s instanceof tv.Xs||s instanceof t9.hi||s instanceof tv.$b)return s;if(!(0,t9.TD)(s))return new tE(s,"home party(".concat(s.name,")のcharactorにisVisitor propertyがありません"));let i=(0,t5.r7)(t.visitor);if(i instanceof h.m||i instanceof tv.Xs||i instanceof t9.hi||i instanceof tv.$b)return i;if(!(0,t9.TD)(i))return new tE(i,"visitor party(".concat(i.name,")のcharactorにisVisitor propertyがありません"));let a=[];for(let e of t.turns){let t=t2(e);if(t instanceof h.m||t instanceof tv.Xs||t instanceof tv.$b||t instanceof tE)return t;a.push(t)}let{result:o}=t;return{title:n,home:s,visitor:i,turns:a,result:o}},et="battle",ee=t=>async e=>t.save(et,e.title,t4(e)),er=t=>async e=>{let r=await t.get(et,e);return r?t8(r):null},en=t=>async e=>t.remove(et,e),es=t=>async()=>t.list(et),ei=t=>async(e,r)=>t.exportJson(et,e,r),ea=async t=>(await t.checkNamespace(et),{save:ee(t),list:es(t),get:er(t),remove:en(t),exportJson:ei(t)});var eo=r(8429),ec=r(1163),el=r(1664),eu=r.n(el),eh=r(5332),ef=r(7536),ep=r(8020),em=r(6529),ed=r(1731),ey=r(2916),ex=r(1001),ej=r(8371),ew=r(2757),ev=r(5541),eg=r(3090),eb=r(1039),eS=r(1077),eI=r(1581),eV=r.n(eI);let eC="DO_NOTHING";class eO{constructor(t){this.message=t}}let eN={type:"object",properties:{skillName:{type:"string",minLength:1,errorMessage:{minLength:"skillName field is required"}},receiversWithIsVisitor:{type:"array",items:{type:"object",properties:{value:{type:"string",minLength:1,errorMessage:{minLength:"receiversWithIsVisitor field is required"}}},required:["value"]}}},required:["skillName","receiversWithIsVisitor"]},eR=t=>({value:"".concat(t.name,"__").concat((0,tb.oR)(t.isVisitor)),label:"".concat(t.name,"(").concat((0,tb.oR)(t.isVisitor),")")}),eD=(t,e)=>{let r=t.match(/^(.*)__(HOME|VISITOR)$/);if(!r)throw Error("no match");let n=r[0];if(!n)throw Error("no name");let s=r[1];if("HOME"!==s&&"VISITOR"!==s)throw Error("isVisitorStr must be HOME or VISITOR. (".concat(s,")"));let i="VISITOR"===s,a=e.find(t=>t.name===n&&t.isVisitor===i);return a||new tv.Xs(n,"charactor","".concat(n,"というcharactorは存在しません"))},eT=(t,e)=>{let r=new(eV()),n=r.compile(eN);if(!n(t)){let{errors:t}=n;return console.debug(t),new tv.$b(t,"partyのformデータではありません")}let{skillName:s}=t;if(s===eC)return null;let i=tw(s);if(!i)return new tv.Xs(s,"skill","".concat(s,"というskillは存在しません"));let a=new Set(t.receiversWithIsVisitor.map(t=>t.value));if(a.size!==t.receiversWithIsVisitor.length)return new eO("同じキャラクターを複数回えらべません");let o=[];for(let r of t.receiversWithIsVisitor){let t=eD(r.value,e);if(t instanceof tv.Xs)return t;o.push(t)}return{skill:i,receivers:o}},eE=t=>{let{battle:e}=t,r="".concat(e.home.name,"(HOME) vs ").concat(e.visitor.name,"(VISITOR)");switch(e.result){case tk:return(0,s.jsx)(c.x,{children:"".concat(r," HOME側の勝利")});case tL:return(0,s.jsx)(c.x,{children:"".concat(r," VISITOR側の勝利")});case tW:return(0,s.jsx)(c.x,{children:"".concat(r," 引き分け")});default:return(0,s.jsx)(c.x,{children:r})}},e_=t=>{let{battle:e,actor:r,lastTurn:n,skill:a,index:c,getValues:l,register:u}=t,h="receiversWithIsVisitor.".concat(c,".value"),[f,p]=(0,i.useState)(null);if(!a)return null;let m=n.sortedCharactors.map(eR);return(0,s.jsxs)(o.xu,{children:[(0,s.jsxs)(ep.NI,{children:[(0,s.jsx)(em.l,{htmlFor:h,children:"receiver"}),(0,s.jsx)(ed.P,{...u(h,{onBlur:()=>{if(!a){p(null);return}let t=l(h),s=eD(t,n.sortedCharactors);if(s instanceof tv.Xs){p(null);return}let i=tP(e,r,a,[s],new Date,tC()),o=i.sortedCharactors.find(t=>t.isVisitor===s.isVisitor&&t.name===s.name);p(o||null)}}),placeholder:"receiver",children:m.map(t=>(0,s.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))})]}),(0,s.jsx)(o.xu,{children:f&&(0,s.jsx)(eS.i,{charactor:f})})]})},ek=t=>{let{battle:e,actor:r,store:n}=t,i=async()=>{if(window.confirm("降参してもよいですか？")){let t=tK(e,r,new Date);e.turns.push(t),await n.save({...e,result:r.isVisitor?tk:tL})}};return(0,s.jsx)(ey.z,{type:"button",onClick:i,children:"降参"})},eL=t=>{let{actor:e,replace:r,getValues:n,register:i,errors:a}=t,o=(0,tb.SM)(e),c=o.filter(t=>t.mpConsumption<=e.mp).filter(t=>!(0,tD.V)(tR.silent,e)||t.magicType===U.LB).map(t=>({value:t.name,label:t.name}));return c.push({value:eC,label:"何もしない"}),(0,s.jsxs)(ep.NI,{isInvalid:!!a.skillName,children:[(0,s.jsx)(em.l,{htmlFor:"skill",children:"skill"}),(0,s.jsx)(ed.P,{...i("skillName",{onBlur:()=>{let t=n("skillName");if(t===eC){r([]);return}let e=tw(t);if(!e||!e.receiverCount){r([]);return}let s=Array(e.receiverCount).fill("");r(s)}}),placeholder:"skill",children:c.map(t=>(0,s.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))}),(0,s.jsx)(ex.J1,{children:!!a.skillName&&a.skillName.message})]})},eW=async(t,e,r,n)=>{if(null===n)e.turns.push(tG(e,r,new Date));else{let t=n.skill,s="SKILL_TO_FIELD"===t.type?tB(e,r,t,new Date,tV()):tP(e,r,t,n.receivers,new Date,tV());e.turns.push(s)}if(e.result=tU(e),e.result!==t_){await t.save(e);return}let s=tH(e);if(e.turns.push(tJ(e,s.restWt,new Date,tV())),e.result=tU(e),e.result!==t_){await t.save(e);return}for(;(0,tD.V)(tR.sleep,s);)if(e.turns.push(tG(e,s,new Date)),e.result=tU(e),e.result!==t_||(s=tH(e),e.turns.push(tJ(e,s.restWt,new Date,tV())),e.result=tU(e),e.result!==t_)){await t.save(e);return}await t.save(e)},eM=t=>{let{battle:e,store:r}=t,n=tM(e),a=tH(e),{handleSubmit:l,register:u,getValues:h,formState:{errors:f,isSubmitting:p},control:m}=(0,ef.cI)({resolver:(0,eh.G)(eN)}),{fields:d,replace:y}=(0,ef.Dq)({control:m,name:"receiversWithIsVisitor"}),[x,j]=(0,i.useState)(""),w=async t=>{let s=eT(t,n.sortedCharactors);if(s instanceof tv.$b||s instanceof tv.Xs){j("入力してください");return}if(s instanceof eO){j(s.message);return}window.confirm("実行していいですか？")&&await eW(r,e,a,s)},v=a.isVisitor?(0,s.jsx)(ej.Vp,{children:"VISITOR"}):(0,s.jsx)(ej.Vp,{children:"HOME"});return(0,s.jsxs)(o.xu,{p:4,children:[(0,s.jsx)(eu(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(c.x,{children:"This is the battle page"}),e.result!==t_&&(0,s.jsx)(ey.z,{type:"button",onClick:()=>r.exportJson&&r.exportJson(e.title,""),children:"Export"}),(0,s.jsx)(eE,{battle:e}),(0,s.jsxs)("form",{onSubmit:l(w),children:[x&&(0,s.jsx)(ex.J1,{children:x}),e.result===t_&&(0,s.jsx)(ek,{battle:e,actor:a,store:r}),(0,s.jsxs)(o.xu,{as:"dl",children:[(0,s.jsx)(ew.X,{as:"dt",children:"battle title"}),(0,s.jsx)(c.x,{as:"dd",children:e.title})]}),(0,s.jsxs)(c.x,{children:["".concat(a.name,"のターン"),v]}),(0,s.jsx)(eL,{actor:a,getValues:h,register:u,errors:f,replace:y}),(0,s.jsx)(ev.aV,{children:d.map((t,r)=>(0,s.jsx)(ev.HC,{children:(0,s.jsx)(e_,{battle:e,actor:a,lastTurn:n,skill:tw(h("skillName")),getValues:h,register:u,index:r})},"receiversWithIsVisitor.".concat(r)))}),(0,s.jsx)(ey.z,{colorScheme:"teal",isLoading:p,type:"submit",children:"実行"})]}),(0,s.jsx)(o.xu,{children:(0,s.jsx)(ev.aV,{children:n.sortedCharactors.map(t=>(0,s.jsx)(ev.HC,{children:(0,s.jsx)(eS.i,{charactor:t})},"CharactorDetail-".concat(t.name,"-").concat((0,tb.oR)(t.isVisitor))))})})]})},eH=t=>{let{store:e,battleTitle:r}=t,n=(0,eb.useLiveQuery)(()=>e.get(r),[r]);if(!e.exportJson)throw Error("invalid store");return n instanceof h.m||n instanceof tv.Xs||n instanceof t9.hi||n instanceof tv.$b||n instanceof tE?(0,s.jsxs)(o.xu,{children:[(0,s.jsx)(c.x,{children:n.message}),(0,s.jsx)(eu(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})})]}):n?(0,s.jsx)(eM,{battle:n,store:e}):(0,s.jsxs)(o.xu,{children:[(0,s.jsx)(eu(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(c.x,{children:"".concat(r,"というbattleは見つかりません")})]})},eA=t=>{let{type:e,party:r,setParty:n}=t,i=async()=>{let t=await (0,eo.x)();if(!t)return;let e=(0,t5.r7)(t);if(e instanceof h.m||e instanceof tv.Xs||e instanceof t9.hi||e instanceof tv.$b){window.alert(e.message);return}n(e)};return(0,s.jsxs)(o.xu,{children:[r&&(0,s.jsx)(c.x,{children:"".concat(e," Party: ").concat(r.name)}),(0,s.jsx)(ey.z,{type:"button",onClick:i,children:"Select ".concat(e," Party")})]})},e$=t=>{let{store:e}=t,r=(0,ec.useRouter)(),[n,a]=(0,i.useState)(""),{handleSubmit:l,register:u,formState:{errors:h,isSubmitting:f}}=(0,ef.cI)(),[p,m]=(0,i.useState)(null),[d,y]=(0,i.useState)(null),x=async t=>{let n=[],{title:s}=t;if(!s){n.push("titleを入力してください");return}if(!p){n.push("home partyを入力してください");return}if(!d){n.push("visitor partyを入力してください");return}if(n.length>0){a(n.join("\n"));return}let i=t$(s,p,d),o=tq(i,new Date,tV());i.turns.push(o);let c=tH(i);i.turns.push(tJ(i,c.restWt,new Date,tV())),await e.save(i),await r.push({pathname:"battle",query:{title:i.title}})};return(0,s.jsxs)(o.xu,{p:4,children:[(0,s.jsx)(eu(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(c.x,{children:"This is the battle page"}),(0,s.jsxs)("form",{onSubmit:l(x),children:[n&&(0,s.jsx)(ex.J1,{children:n}),(0,s.jsxs)(ep.NI,{isInvalid:!!h.title,children:[(0,s.jsx)(em.l,{htmlFor:"title",children:"title"}),(0,s.jsx)(eg.I,{id:"title",placeholder:"title",...u("title")}),(0,s.jsx)(ex.J1,{children:h.title&&h.title.message})]}),(0,s.jsx)(eA,{type:"HOME",party:p,setParty:m}),(0,s.jsx)(eA,{type:"VISITOR",party:d,setParty:y}),(0,s.jsx)(ey.z,{colorScheme:"teal",isLoading:f,type:"submit",children:"Start Battle"})]})]})},eq=t=>{let{store:e}=t,r=(0,eb.useLiveQuery)(()=>e.list(),[]);return(0,s.jsxs)(o.xu,{children:[(0,s.jsx)(eu(),{href:{pathname:"/"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(o.xu,{children:(0,s.jsxs)(ev.aV,{children:[(0,s.jsx)(ev.HC,{children:(0,s.jsx)(eu(),{href:{pathname:"battle",query:{name:"__new"}},children:(0,s.jsx)("a",{children:"新しく作る"})})},"battle-new"),r&&r.map((t,e)=>(0,s.jsx)(ev.HC,{children:(0,s.jsx)(eu(),{href:{pathname:"battle",query:{name:t}},children:(0,s.jsx)("a",{children:t})})},"battle-".concat(e)))]})})]})};var eG=()=>{let t=(0,a.useSearchParams)(),e=t.get("title"),[r,n]=(0,i.useState)(null);return((0,i.useEffect)(()=>{(async()=>{let t=await (0,eo.h)(),e=await ea(t);n(e)})()},[]),r)?e?"__new"===e?(0,s.jsx)(e$,{store:r}):(0,s.jsx)(eH,{battleTitle:e,store:r}):(0,s.jsx)(eq,{store:r}):(0,s.jsx)(o.xu,{children:(0,s.jsx)(c.x,{children:"loading..."})})}}},function(t){t.O(0,[664,596,808,971,774,888,179],function(){return t(t.s=7156)}),_N_E=t.O()}]);