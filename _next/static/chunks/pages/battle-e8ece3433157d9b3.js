(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7156:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle",function(){return r(3989)}])},3989:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return eG}});var n={};r.r(n),r.d(n,{blindBull:function(){return m.q},blow:function(){return d.D},chop:function(){return p.p},clearCloud:function(){return x.D},coldFeet:function(){return y.v},concentration:function(){return j.c},copperBlue:function(){return w.x},crossFire:function(){return v.T},cumulonimbus:function(){return S.s},danceLeaves:function(){return b.n},dazzle:function(){return I.y},downRushing:function(){return g.e},eleciWave:function(){return C.Q},electoricBrain:function(){return V.n},electricShock:function(){return O.Z},fireWall:function(){return R.B},flameDigger:function(){return N._},flameFall:function(){return D.N},flashFlood:function(){return T.l},frostbite:function(){return E.f},ghostFire:function(){return _.d},gravelWall:function(){return k.c},guillotineOfGiant:function(){return L.H},gunStone:function(){return W.G},gunWater:function(){return z.v},hailstone:function(){return M.p},hardRain:function(){return H.u},heavyWind:function(){return $.m},higherBolt:function(){return A.W},iceSandwich:function(){return P.C},jammer:function(){return G.q},lightMeteor:function(){return X.P},mountFall:function(){return F.t},multiShot:function(){return B.j},overbear:function(){return K.m},paralysisScratch:function(){return q.r},paralysisShot:function(){return U.$},pitch:function(){return Z},push:function(){return Y.V},quench:function(){return Q.n},quick:function(){return tt.P},rockWave:function(){return te.j},saturnRing:function(){return tr.C},shot:function(){return tn.o},silent:function(){return ts.C},silentScratch:function(){return ta.d},silentShot:function(){return ti.T},slow:function(){return tc.Y},smallHeat:function(){return to.b},stab:function(){return tl.R},stickyRain:function(){return tu.f},stoneShell:function(){return th.v},stoneWeather:function(){return tf.c},swordDance:function(){return tm.f},thunder:function(){return td.o},tornade:function(){return tp.V},toxicScratch:function(){return tx.x},toxicShot:function(){return ty.c},waterCutter:function(){return tj.f},windEdge:function(){return tw.D}});var s=r(5893),a=r(7294),i=r(9332),c=r(7747),o=r(4e3),l=r(1604),u=r(4037),h=r(4201),f=r(4969),m=r(7510),d=r(2332),p=r(176),x=r(3185),y=r(6805),j=r(7113),w=r(667),v=r(340),S=r(6140),b=r(7453),I=r(3331),g=r(9170),C=r(3733),V=r(1538),O=r(1202),R=r(3181),N=r(6066),D=r(2274),T=r(4012),E=r(9969),_=r(113),k=r(1944),L=r(2131),W=r(9319),z=r(9502),M=r(1132),H=r(6516),$=r(5537),A=r(1137),P=r(6796),G=r(9246),X=r(9520),F=r(5311),B=r(2516),K=r(2144),q=r(1177),U=r(9053),J=r(9199);let Z={name:"pitch",label:"投げる",type:"SKILL_TO_CHARACTOR",action:J.Vo,directType:J.Vq,magicType:J.LB,baseDamage:60,mpConsumption:10,receiverCount:1,additionalWt:100,effectLength:5,getAccuracy:J.Tj,description:"投げる"};var Y=r(515),Q=r(4729),tt=r(8997),te=r(9918),tr=r(1089),tn=r(8036),ts=r(1293),ta=r(2252),ti=r(2211),tc=r(7882),to=r(4116),tl=r(5822),tu=r(9434),th=r(8323),tf=r(5319),tm=r(9205),td=r(6815),tp=r(9083),tx=r(2057),ty=r(4103),tj=r(2421),tw=r(5454);let tv=t=>n[t];Object.keys(n),Object.values(n);var tS=r(8227),tb=r(3429),tI=r(7442);class tg{constructor(t,e,r){this.prop=t,this.value=e,this.message=r}}let tC=t=>{let{times:e,damage:r,accuracy:n}=t;return e>1||e<0?new tg("times",e,"timesの値は0から1です"):r>1||r<0?new tg("damage",r,"damageの値は0から1です"):n>1||n<0?new tg("accuracy",n,"accuracyの値は0から1です"):null},tV=()=>({times:Math.random(),damage:Math.random(),accuracy:Math.random()}),tO=()=>({times:1,damage:1,accuracy:1}),tR=[{name:"SUNNY",parcent:40},{name:"RAIN",parcent:30},{name:"FOGGY",parcent:10},{name:"STORM",parcent:10},{name:"SNOW",parcent:10}],tN=t=>{let e=tC(t);if(e instanceof tg)throw console.debug(e),Error(e.message);let r=100*t.accuracy,n=tR.reduce((t,e)=>{let r={...e};if(0===t.length)return[r];let n=t.slice(-1)[0];return r.parcent+=n.parcent,t.push(r),t},[]),s=n.find(t=>t.parcent>=r);return s?s.name:"SUNNY"};var tD=r(2457),tT=r(4168);let tE=t=>t.slice(-1)[0];class t_{constructor(t,e){this.charactor=t,this.message=e}}let tk="ONGOING",tL="HOME",tW="VISITOR",tz="DRAW",tM=t=>tE(t.turns),tH=t=>tE(t.turns).sortedCharactors[0],t$=t=>t.filter(t=>t.hp>0).sort((t,e)=>{let r=(0,tI.SR)(t),n=(0,tI.SR)(e),s=t.restWt-e.restWt;if(0!==s)return s;let a=r.AGI-n.AGI;if(0!==a)return a;let i=r.AVD-n.AVD;if(0!==i)return i;let c=t.hp-e.hp;if(0!==c)return c;let o=t.mp-e.mp;if(0!==o)return o;let l=t.statuses.length-e.statuses.length;return 0!==l?l:0}),tA=(t,e,r)=>{let n={name:e.name,charactors:e.charactors.map(t=>({...t,isVisitor:!1}))},s={name:r.name,charactors:r.charactors.map(t=>({...t,isVisitor:!0}))};return{title:t,home:n,visitor:s,turns:[],result:tk}},tP=(t,e,r)=>({datetime:e,action:{type:"TIME_PASSING",wt:0},sortedCharactors:t$([...t.home.charactors,...t.visitor.charactors]),field:{climate:tN(r)}}),tG=(t,e,r)=>{let n=tE(t.turns),s={datetime:r,action:{type:"DO_NOTHING",actor:e},sortedCharactors:n.sortedCharactors,field:n.field};return s.sortedCharactors=s.sortedCharactors.map(t=>{let r={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(r.restWt=(0,tI.SR)(t).WT),r}),s.sortedCharactors=t$(s.sortedCharactors),s},tX=t=>e=>{let r=t.find(t=>e.name===t.name);return r||e},tF=(t,e,r,n,s,a)=>{if("SKILL_TO_FIELD"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,tT.V)(tD.silent,e)&&r.magicType!==J.LB)throw Error("silent cannot do magic");if((0,tT.V)(tD.sleep,e)||(0,tT.V)(tD.paralysis,e)&&a.accuracy>.5)return tG(t,e,s);let i=tE(t.turns),c={datetime:s,action:{type:"DO_SKILL",actor:e,skill:r,receivers:n},sortedCharactors:i.sortedCharactors,field:i.field},o=n.map(t=>r.action(r,e,a,i.field,t));return c.sortedCharactors=c.sortedCharactors.map(tX(o)),c.sortedCharactors=c.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tI.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),c.sortedCharactors=t$(c.sortedCharactors),c},tB=(t,e,r,n,s)=>{if("SKILL_TO_CHARACTOR"===r.type)throw Error("invalid skill type");if(r.mpConsumption>e.mp)throw Error("mp shortage");if((0,tT.V)(tD.silent,e)&&r.magicType!==J.LB)throw Error("silent cannot do magic");if((0,tT.V)(tD.sleep,e)||(0,tT.V)(tD.paralysis,e)&&s.accuracy>.5)return tG(t,e,n);let a=tE(t.turns),i={datetime:n,action:{type:"DO_SKILL",actor:e,skill:r,receivers:[]},sortedCharactors:a.sortedCharactors,field:a.field};return i.field=r.action(r,e,s,a.field),i.sortedCharactors=i.sortedCharactors.map(t=>{let n={...t,statuses:[...t.statuses.map(t=>({...t}))]};return e.isVisitor===t.isVisitor&&e.name===t.name&&(n.restWt=(0,tI.SR)(t).WT+r.additionalWt,n.mp-=r.mpConsumption),n}),i.sortedCharactors=t$(i.sortedCharactors),i},tK=(t,e,r)=>{let n=tE(t.turns);return{datetime:r,action:{type:"SURRENDER",actor:e},sortedCharactors:n.sortedCharactors,field:n.field}},tq=(t,e,r)=>{let n=(0,tI.BA)(t),s=n.reduce((t,n)=>n.wait(e,t,r),{...t,statuses:[...t.statuses.map(t=>({...t}))]}),a=(0,tT.V)(tD.quick,s)?1.5:(0,tT.V)(tD.slow,s)?.75:1;s.restWt=Math.max(s.restWt-e*a,0),(0,tT.V)(tD.acid,s)&&(s.hp=Math.max(s.hp-e/10,0)),s.statuses=s.statuses.map(t=>{let r=t.restWt-e;return{...t,restWt:r}}).filter(t=>t.restWt>0);let i=(0,tI.SR)(s);return s.mp=Math.min(s.mp+Math.floor(e/10),i.MaxMP),s},tU=(t,e,r,n)=>{let s=tE(t.turns),a={datetime:r,action:{type:"TIME_PASSING",wt:e},sortedCharactors:s.sortedCharactors,field:{climate:tN(n)}};return a.sortedCharactors=a.sortedCharactors.map(t=>tq(t,e,n)),a},tJ=t=>{let e=tE(t.turns);if("SURRENDER"===e.action.type)return e.action.actor.isVisitor?tL:tW;let r=e.sortedCharactors.filter(t=>!t.isVisitor&&t.hp),n=e.sortedCharactors.filter(t=>t.isVisitor&&t.hp);return 0===r.length&&0===n.length?tz:r.length>0&&0===n.length?tL:0===r.length&&n.length>0?tW:tk},tZ=l.z.object({type:l.z.literal("SURRENDER"),actor:tb.lo}),tY=l.z.object({type:l.z.literal("DO_SKILL"),actor:tb.lo,skill:l.z.string(),receivers:l.z.array(tb.lo)}),tQ=l.z.object({type:l.z.literal("DO_NOTHING"),actor:tb.lo}),t0=l.z.object({type:l.z.literal("TIME_PASSING"),wt:l.z.number().int()}),t1=l.z.discriminatedUnion("type",[tY,tQ,t0,tZ]),t3=l.z.object({datetime:l.z.string().datetime({local:!0}),action:t1,sortedCharactors:l.z.array(tb.lo),field:l.z.object({climate:l.z.string()})}),t9=t=>"DO_SKILL"===t.type?{type:"DO_SKILL",actor:(0,tb.AM)(t.actor),skill:t.skill.name,receivers:t.receivers.map(tb.AM)}:"SURRENDER"===t.type?{type:"SURRENDER",actor:(0,tb.AM)(t.actor)}:"DO_NOTHING"===t.type?{type:"DO_NOTHING",actor:(0,tb.AM)(t.actor)}:{type:"TIME_PASSING",wt:t.wt},t2=t=>(0,h.Z)(t,"yyyy-MM-dd'T'HH:mm:ss"),t7=t=>({datetime:t2(t.datetime),action:t9(t.action),sortedCharactors:t.sortedCharactors.map(tb.AM),field:t.field}),t5=t=>{let e=t1.safeParse(t);if(!e.success)return new tS.$b(e.error,"actionのjsonデータではありません");let r=e.data;if("DO_SKILL"===r.type){let t=(0,tb.m$)(r.actor);if(t instanceof f.m||t instanceof tS.Xs||t instanceof tS.$b)return t;if(!(0,tI.Ix)(t))return new t_(t,"actor(".concat(t.name,")にisVisitor propertyがありません"));let e=[];for(let t of r.receivers){let r=(0,tb.m$)(t);if(r instanceof f.m||r instanceof tS.Xs||r instanceof tS.$b)return r;if(!(0,tI.Ix)(r))return new t_(r,"receiver(".concat(r.name,")にisVisitor propertyがありません"));e.push(r)}let n=tv(r.skill);return n?{type:"DO_SKILL",actor:t,skill:n,receivers:e}:new tS.Xs(r.skill,"skill","".concat(r.skill,"というskillは存在しません"))}if("SURRENDER"===r.type){let t=(0,tb.m$)(r.actor);return t instanceof f.m||t instanceof tS.Xs||t instanceof tS.$b?t:(0,tI.Ix)(t)?{type:"SURRENDER",actor:t}:new t_(t,"actor(".concat(t.name,")にisVisitor propertyがありません"))}if("DO_NOTHING"===r.type){let t=(0,tb.m$)(r.actor);return t instanceof f.m||t instanceof tS.Xs||t instanceof tS.$b?t:(0,tI.Ix)(t)?{type:"DO_NOTHING",actor:t}:new t_(t,"actor(".concat(t.name,")にisVisitor propertyがありません"))}return{type:"TIME_PASSING",wt:0+r.wt}},t4=t=>{let e=t3.safeParse(t);if(!e.success)return new tS.$b(e.error,"turnのjsonデータではありません");let r=e.data,n=null;try{n=(0,u.Z)(r.datetime,"yyyy-MM-dd'T'HH:mm:ss",new Date)}catch(t){return new tS.$b(t,"日付が間違っています")}let s=t5(r.action);if(s instanceof f.m||s instanceof tS.Xs||s instanceof tS.$b||s instanceof t_)return s;let a=[];for(let t of r.sortedCharactors){let e=(0,tb.m$)(t);if(e instanceof f.m||e instanceof tS.Xs||e instanceof tS.$b)return e;if(!(0,tI.Ix)(e))return new t_(e,"charactor(".concat(e.name,")にisVisitor propertyがありません"));a.push(e)}let i={climate:r.field.climate};return{datetime:n,action:s,sortedCharactors:a,field:i}};var t6=r(4533),t8=r(5618);let et=l.z.object({title:l.z.string(),home:t6.ZL,visitor:t6.ZL,turns:l.z.array(t3),result:l.z.enum([tk,tL,tW,tz])}),ee=t=>({title:t.title,home:(0,t6.KD)(t.home),visitor:(0,t6.KD)(t.visitor),turns:t.turns.map(t7),result:t.result}),er=t=>{let e=et.safeParse(t);if(!e.success)return new tS.$b(e.error,"battleのjsonデータではありません");let r=e.data,{title:n}=r,s=(0,t6.r7)(r.home);if(s instanceof f.m||s instanceof tS.Xs||s instanceof t8.hi||s instanceof tS.$b)return s;if(!(0,t8.TD)(s))return new t_(s,"home party(".concat(s.name,")のcharactorにisVisitor propertyがありません"));let a=(0,t6.r7)(r.visitor);if(a instanceof f.m||a instanceof tS.Xs||a instanceof t8.hi||a instanceof tS.$b)return a;if(!(0,t8.TD)(a))return new t_(a,"visitor party(".concat(a.name,")のcharactorにisVisitor propertyがありません"));let i=[];for(let t of r.turns){let e=t4(t);if(e instanceof f.m||e instanceof tS.Xs||e instanceof tS.$b||e instanceof t_)return e;i.push(e)}let{result:c}=r;return{title:n,home:s,visitor:a,turns:i,result:c}},en="battle",es=t=>async e=>t.save(en,e.title,ee(e)),ea=t=>async e=>{let r=await t.get(en,e);return r?er(r):null},ei=t=>async e=>t.remove(en,e),ec=t=>async()=>t.list(en),eo=t=>async(e,r)=>t.exportJson(en,e,r),el=async t=>(await t.checkNamespace(en),{save:es(t),list:ec(t),get:ea(t),remove:ei(t),exportJson:eo(t)});var eu=r(8429),eh=r(1163),ef=r(1664),em=r.n(ef),ed=r(6312),ep=r(7536),ex=r(8020),ey=r(6529),ej=r(1731),ew=r(2916),ev=r(1001),eS=r(8371),eb=r(2757),eI=r(5541),eg=r(3090),eC=r(1039),eV=r(1077);let eO="DO_NOTHING";class eR{constructor(t){this.message=t}}let eN=l.z.object({skillName:l.z.string().min(1),receiversWithIsVisitor:l.z.array(l.z.object({value:l.z.string().min(1)}))}),eD=t=>({value:"".concat(t.name,"__").concat((0,tI.oR)(t.isVisitor)),label:"".concat(t.name,"(").concat((0,tI.oR)(t.isVisitor),")")}),eT=(t,e)=>{let r=t.match(/^(.*)__(HOME|VISITOR)$/);if(!r)throw Error("no match");let n=r[1];if(!n)throw Error("no name");let s=r[2];if("HOME"!==s&&"VISITOR"!==s)throw Error("isVisitorStr must be HOME or VISITOR. (".concat(s,")"));let a="VISITOR"===s,i=e.find(t=>t.name===n&&t.isVisitor===a);return i||new tS.Xs(n,"charactor","".concat(n,"というcharactorは存在しません"))},eE=(t,e)=>{let r=eN.safeParse(t);if(!r.success)return new tS.$b(r.error,"partyのformデータではありません");let n=r.data,{skillName:s}=n;if(s===eO)return null;let a=tv(s);if(!a)return new tS.Xs(s,"skill","".concat(s,"というskillは存在しません"));let i=new Set(n.receiversWithIsVisitor.map(t=>t.value));if(i.size!==n.receiversWithIsVisitor.length)return new eR("同じキャラクターを複数回えらべません");let c=[];for(let t of n.receiversWithIsVisitor){let r=eT(t.value,e);if(r instanceof tS.Xs)return r;c.push(r)}return{skill:a,receivers:c}},e_=t=>{let{battle:e}=t,r="".concat(e.home.name,"(HOME) vs ").concat(e.visitor.name,"(VISITOR)");switch(e.result){case tL:return(0,s.jsx)(o.x,{children:"".concat(r," HOME側の勝利")});case tW:return(0,s.jsx)(o.x,{children:"".concat(r," VISITOR側の勝利")});case tz:return(0,s.jsx)(o.x,{children:"".concat(r," 引き分け")});default:return(0,s.jsx)(o.x,{children:r})}},ek=t=>{let{battle:e,actor:r,lastTurn:n,skill:i,index:o,getValues:l,register:u}=t,h="receiversWithIsVisitor.".concat(o,".value"),[f,m]=(0,a.useState)(null);if(!i)return null;let d=n.sortedCharactors.map(eD);return(0,s.jsxs)(c.xu,{children:[(0,s.jsxs)(ex.NI,{children:[(0,s.jsx)(ey.l,{htmlFor:h,children:"receiver"}),(0,s.jsx)(ej.P,{...u(h,{onBlur:()=>{if(!i){m(null);return}let t=l(h),s=eT(t,n.sortedCharactors);if(s instanceof tS.Xs){m(null);return}let a=tF(e,r,i,[s],new Date,tO()),c=a.sortedCharactors.find(t=>t.isVisitor===s.isVisitor&&t.name===s.name);c||m("".concat(s.name," will dead")),m(c||null)}}),placeholder:"receiver",children:d.map(t=>(0,s.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))})]}),(0,s.jsx)(c.xu,{children:f&&("string"==typeof f?f:(0,s.jsx)(eV.i,{charactor:f}))})]})},eL=t=>{let{battle:e,actor:r,store:n}=t,a=async()=>{if(window.confirm("降参してもよいですか？")){let t=tK(e,r,new Date);e.turns.push(t),await n.save({...e,result:r.isVisitor?tL:tW})}};return(0,s.jsx)(ew.z,{type:"button",onClick:a,children:"降参"})},eW=t=>{let{actor:e,replace:r,getValues:n,register:a,errors:i}=t,c=(0,tI.SM)(e),o=c.filter(t=>t.mpConsumption<=e.mp).filter(t=>!(0,tT.V)(tD.silent,e)||t.magicType===J.LB).map(t=>({value:t.name,label:t.name}));return o.push({value:eO,label:"何もしない"}),(0,s.jsxs)(ex.NI,{isInvalid:!!i.skillName,children:[(0,s.jsx)(ey.l,{htmlFor:"skill",children:"skill"}),(0,s.jsx)(ej.P,{...a("skillName",{onBlur:()=>{let t=n("skillName");if(t===eO){r([]);return}let e=tv(t);if(!e||!e.receiverCount){r([]);return}let s=Array(e.receiverCount).fill("");r(s)}}),placeholder:"skill",children:o.map(t=>(0,s.jsx)("option",{value:t.value,children:t.label},"".concat(t.value)))}),(0,s.jsx)(ev.J1,{children:!!i.skillName&&i.skillName.message})]})},ez=async(t,e,r,n)=>{if(null===n)e.turns.push(tG(e,r,new Date));else{let t=n.skill,s="SKILL_TO_FIELD"===t.type?tB(e,r,t,new Date,tV()):tF(e,r,t,n.receivers,new Date,tV());e.turns.push(s)}if(e.result=tJ(e),e.result!==tk){await t.save(e);return}let s=tH(e);if(e.turns.push(tU(e,s.restWt,new Date,tV())),e.result=tJ(e),e.result!==tk){await t.save(e);return}for(;(0,tT.V)(tD.sleep,s);)if(e.turns.push(tG(e,s,new Date)),e.result=tJ(e),e.result!==tk||(s=tH(e),e.turns.push(tU(e,s.restWt,new Date,tV())),e.result=tJ(e),e.result!==tk)){await t.save(e);return}await t.save(e)},eM=t=>{let{battle:e,store:r}=t,n=tM(e),i=tH(e),{handleSubmit:l,register:u,getValues:h,formState:{errors:f,isSubmitting:m},control:d}=(0,ep.cI)({resolver:(0,ed.F)(eN)}),{fields:p,replace:x}=(0,ep.Dq)({control:d,name:"receiversWithIsVisitor"}),[y,j]=(0,a.useState)(""),w=async t=>{let s=eE(t,n.sortedCharactors);if(s instanceof tS.$b||s instanceof tS.Xs){j("入力してください");return}if(s instanceof eR){j(s.message);return}window.confirm("実行していいですか？")&&(x([]),await ez(r,e,i,s))},v=i.isVisitor?(0,s.jsx)(eS.Vp,{children:"VISITOR"}):(0,s.jsx)(eS.Vp,{children:"HOME"});return(0,s.jsxs)(c.xu,{p:4,children:[(0,s.jsx)(em(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(o.x,{children:"This is the battle page"}),e.result!==tk&&(0,s.jsx)(ew.z,{type:"button",onClick:()=>r.exportJson&&r.exportJson(e.title,""),children:"Export"}),(0,s.jsx)(e_,{battle:e}),e.result===tk&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("form",{onSubmit:l(w),children:[y&&(0,s.jsx)(ev.J1,{children:y}),e.result===tk&&(0,s.jsx)(eL,{battle:e,actor:i,store:r}),(0,s.jsxs)(c.xu,{as:"dl",children:[(0,s.jsx)(eb.X,{as:"dt",children:"battle title"}),(0,s.jsx)(o.x,{as:"dd",children:e.title})]}),(0,s.jsxs)(o.x,{children:["".concat(i.name,"のターン"),v]}),(0,s.jsx)(eW,{actor:i,getValues:h,register:u,errors:f,replace:x}),(0,s.jsx)(eI.aV,{children:p.map((t,r)=>(0,s.jsx)(eI.HC,{children:(0,s.jsx)(ek,{battle:e,actor:i,lastTurn:n,skill:tv(h("skillName")),getValues:h,register:u,index:r})},"receiversWithIsVisitor.".concat(r)))}),(0,s.jsx)(ew.z,{colorScheme:"teal",isLoading:m,type:"submit",children:"実行"})]}),(0,s.jsx)(c.xu,{children:(0,s.jsx)(eI.aV,{children:n.sortedCharactors.map(t=>(0,s.jsx)(eI.HC,{children:(0,s.jsx)(eV.i,{charactor:t})},"CharactorDetail-".concat(t.name,"-").concat((0,tI.oR)(t.isVisitor))))})})]})]})},eH=t=>{let{store:e,battleTitle:r}=t,n=(0,eC.useLiveQuery)(()=>e.get(r),[r]);if(!e.exportJson)throw Error("invalid store");return n instanceof f.m||n instanceof tS.Xs||n instanceof t8.hi||n instanceof tS.$b||n instanceof t_?(0,s.jsxs)(c.xu,{children:[(0,s.jsx)(o.x,{children:n.message}),(0,s.jsx)(em(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})})]}):n?(0,s.jsx)(eM,{battle:n,store:e}):(0,s.jsxs)(c.xu,{children:[(0,s.jsx)(em(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(o.x,{children:"".concat(r,"というbattleは見つかりません")})]})},e$=t=>{let{type:e,party:r,setParty:n}=t,a=async()=>{let t=await (0,eu.x)();if(!t)return;let e=(0,t6.r7)(t);if(e instanceof f.m||e instanceof tS.Xs||e instanceof t8.hi||e instanceof tS.$b){window.alert(e.message);return}n(e)};return(0,s.jsxs)(c.xu,{children:[r&&(0,s.jsx)(o.x,{children:"".concat(e," Party: ").concat(r.name)}),(0,s.jsx)(ew.z,{type:"button",onClick:a,children:"Select ".concat(e," Party")})]})},eA=t=>{let{store:e}=t,r=(0,eh.useRouter)(),[n,i]=(0,a.useState)(""),{handleSubmit:l,register:u,formState:{errors:h,isSubmitting:f}}=(0,ep.cI)(),[m,d]=(0,a.useState)(null),[p,x]=(0,a.useState)(null),y=async t=>{let n=[],{title:s}=t;if(!s){n.push("titleを入力してください");return}if(!m){n.push("home partyを入力してください");return}if(!p){n.push("visitor partyを入力してください");return}if(n.length>0){i(n.join("\n"));return}let a=tA(s,m,p),c=tP(a,new Date,tV());a.turns.push(c);let o=tH(a);a.turns.push(tU(a,o.restWt,new Date,tV())),await e.save(a),await r.push({pathname:"battle",query:{title:a.title}})};return(0,s.jsxs)(c.xu,{p:4,children:[(0,s.jsx)(em(),{href:{pathname:"battle"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(o.x,{children:"This is the battle page"}),(0,s.jsxs)("form",{onSubmit:l(y),children:[n&&(0,s.jsx)(ev.J1,{children:n}),(0,s.jsxs)(ex.NI,{isInvalid:!!h.title,children:[(0,s.jsx)(ey.l,{htmlFor:"title",children:"title"}),(0,s.jsx)(eg.I,{id:"title",placeholder:"title",...u("title")}),(0,s.jsx)(ev.J1,{children:h.title&&h.title.message})]}),(0,s.jsx)(e$,{type:"HOME",party:m,setParty:d}),(0,s.jsx)(e$,{type:"VISITOR",party:p,setParty:x}),(0,s.jsx)(ew.z,{colorScheme:"teal",isLoading:f,type:"submit",children:"Start Battle"})]})]})},eP=t=>{let{store:e}=t,r=(0,eC.useLiveQuery)(()=>e.list(),[]);return(0,s.jsxs)(c.xu,{children:[(0,s.jsx)(em(),{href:{pathname:"/"},children:(0,s.jsx)("a",{children:"戻る"})}),(0,s.jsx)(c.xu,{children:(0,s.jsxs)(eI.aV,{children:[(0,s.jsx)(eI.HC,{children:(0,s.jsx)(em(),{href:{pathname:"battle",query:{title:"__new"}},children:(0,s.jsx)("a",{children:"新しく作る"})})},"battle-new"),r&&r.map((t,e)=>(0,s.jsx)(eI.HC,{children:(0,s.jsx)(em(),{href:{pathname:"battle",query:{title:t}},children:(0,s.jsx)("a",{children:t})})},"battle-".concat(e)))]})})]})};var eG=()=>{let t=(0,i.useSearchParams)(),e=t.get("title"),[r,n]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{let t=await (0,eu.h)(),e=await el(t);n(e)})()},[]),r)?e?"__new"===e?(0,s.jsx)(eA,{store:r}):(0,s.jsx)(eH,{battleTitle:e,store:r}):(0,s.jsx)(eP,{store:r}):(0,s.jsx)(c.xu,{children:(0,s.jsx)(o.x,{children:"loading..."})})}}},function(t){t.O(0,[905,198,348,971,774,888,179],function(){return t(t.s=7156)}),_N_E=t.O()}]);