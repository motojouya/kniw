(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[141],{6698:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/party",function(){return a(7635)}])},7635:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return R}});var r=a(5893),t=a(7294),s=a(9332),i=a(7747),c=a(4e3),o=a(4533);let l="party",h=e=>async n=>e.save(l,n.name,(0,o.KD)(n)),m=e=>async n=>{let a=await e.get(l,n);return a?(0,o.r7)(a):null},u=e=>async n=>e.remove(l,n),x=e=>async()=>e.list(l),p=e=>async(n,a)=>e.exportJson(l,n,a),f=async e=>(await e.checkNamespace(l),{save:h(e),list:x(e),get:m(e),remove:u(e),exportJson:p(e)});var d=a(8429),j=a(1163),g=a(1664),w=a.n(g),y=a(1077),b=a(6312),v=a(7536),_=a(1001),z=a(2757),C=a(8020),X=a(6529),k=a(3090),E=a(5541),N=a(2916),S=a(1039),J=a(1604),$=a(8227),I=a(4969),P=a(7442),F=a(524);let H=J.z.object({name:J.z.string().min(1),race:J.z.string().min(1),blessing:J.z.string().min(1),clothing:J.z.string().min(1),weapon:J.z.string().min(1)}),q=e=>({name:e.name,race:e.race.name,blessing:e.blessing.name,clothing:e.clothing.name,weapon:e.weapon.name}),L=e=>{let n=H.safeParse(e);if(!n.success)return new $.$b(n.error,"charactorのデータではありません");let a=n.data,{name:r}=a,t=(0,F.tI)(a.race);if(!t)return new $.Xs(a.race,"race","".concat(a.race,"という種族は存在しません"));let s=(0,F.ez)(a.blessing);if(!s)return new $.Xs(a.blessing,"blessing","".concat(a.blessing,"という祝福は存在しません"));let i=(0,F.FL)(a.clothing);if(!i)return new $.Xs(a.clothing,"clothing","".concat(a.clothing,"という装備は存在しません"));let c=(0,F.i7)(a.weapon);if(!c)return new $.Xs(a.weapon,"weapon","".concat(a.weapon,"という武器は存在しません"));let o=(0,P.Gu)(r,t,s,i,c);if(o instanceof I.m)return o;let l={name:r,race:t,blessing:s,clothing:i,weapon:c,statuses:[],hp:0,mp:0,restWt:0},h=(0,P.SR)(l);return l.hp=h.MaxHP,l.restWt=h.WT,l};var T=a(5618);let V=J.z.object({name:J.z.string().min(1),charactors:J.z.array(H)}),D=e=>({name:e.name,charactors:e.charactors.map(q)}),K=e=>{let n=V.safeParse(e);if(!n.success)return new $.$b(n.error,"partyのformデータではありません");let a=n.data,{name:r}=a,t=[];for(let e of a.charactors){let n=L(e);if(n instanceof $.Xs||n instanceof I.m||n instanceof $.$b)return n;t.push(n)}let s=(0,T.Gu)(r,t);return s instanceof T.hi?s:{name:r,charactors:t}},W=(e,n)=>async a=>{let r=K(a);if(r instanceof $.Xs||r instanceof I.m||r instanceof $.$b||r instanceof T.hi)return r;if(n){let n=await e.list();if(n.includes(r.name))return new $.KC(r.name,"party","".concat(r.name,"というpartyは既に存在します"))}return await e.save(r),null},B=e=>{let{exist:n,partyForm:a,inoutButton:s,store:o}=e,l=(0,j.useRouter)(),{handleSubmit:h,register:m,getValues:u,formState:{errors:x,isSubmitting:p},control:f}=(0,v.cI)({resolver:(0,b.F)(V),defaultValues:a}),{fields:d,append:g,remove:S}=(0,v.Dq)({control:f,name:"charactors"}),[J,P]=(0,t.useState)({error:!1,message:""}),F=async e=>{let a=await W(o,!n)(e);a instanceof $.Xs||a instanceof I.m||a instanceof $.$b||a instanceof T.hi||a instanceof $.KC?P({error:!0,message:a.message}):n?P({error:!1,message:"保存しました"}):await l.push({pathname:"party",query:{name:e.name}})},H=async e=>{window.confirm("削除してもよいですか？")&&(await o.remove(e),await l.push({pathname:"party"}))};return(0,r.jsxs)(i.xu,{p:4,children:[(0,r.jsx)(w(),{href:{pathname:"party"},children:(0,r.jsx)("a",{children:"戻る"})}),(0,r.jsx)(c.x,{children:"This is the party page"}),s,(0,r.jsxs)("form",{onSubmit:h(F),children:[J.message&&(J.error?(0,r.jsx)(_.J1,{children:J.message}):(0,r.jsx)(c.x,{children:J.message})),n?(0,r.jsxs)(i.xu,{as:"dl",children:[(0,r.jsx)(z.X,{as:"dt",children:"party name"}),(0,r.jsx)(c.x,{as:"dd",children:a.name})]}):(0,r.jsxs)(C.NI,{isInvalid:!!x.name,children:[(0,r.jsx)(X.l,{htmlFor:"name",children:"name"}),(0,r.jsx)(k.I,{id:"name",placeholder:"name",...m("name")}),(0,r.jsx)(_.J1,{children:x.name&&x.name.message})]}),(0,r.jsx)(E.aV,{children:d.map((e,n)=>(0,r.jsx)(E.HC,{children:(0,r.jsx)(y.g,{register:m,getValues:u,remove:S,errors:x,index:n})},"charactor-".concat(n)))}),(0,r.jsx)(N.z,{type:"button",onClick:()=>g({name:"",race:"",blessing:"",clothing:"",weapon:""}),children:"Hire"}),(0,r.jsx)(N.z,{colorScheme:"teal",isLoading:p,type:"submit",children:n?"Change":"Create"}),n&&(0,r.jsx)(N.z,{type:"button",onClick:()=>H(a.name),children:"Dismiss"})]})]})},G=e=>{let{store:n,partyName:a}=e,t=(0,S.useLiveQuery)(()=>n.get(a),[a]);if(!n.exportJson)throw Error("invalid store");return t instanceof I.m||t instanceof $.Xs||t instanceof T.hi||t instanceof $.$b?(0,r.jsxs)(i.xu,{children:[(0,r.jsx)(c.x,{children:t.message}),(0,r.jsx)(w(),{href:{pathname:"party"},children:(0,r.jsx)("a",{children:"戻る"})})]}):t?(0,r.jsx)(B,{exist:!0,partyForm:D(t),store:n,inoutButton:(0,r.jsx)(N.z,{type:"button",onClick:()=>n.exportJson&&n.exportJson(t.name,""),children:"Export"})}):(0,r.jsxs)(i.xu,{children:[(0,r.jsx)(c.x,{children:"".concat(a,"というpartyは見つかりません")}),(0,r.jsx)(w(),{href:{pathname:"party"},children:(0,r.jsx)("a",{children:"戻る"})})]})},O=e=>{let{store:n}=e,[a,s]=(0,t.useState)({name:"",charactors:[]}),i=async()=>{if(!window.confirm("取り込むと入力したデータが削除されますがよいですか？"))return;let e=await (0,d.x)();if(!e)return;let n=(0,o.r7)(e);if(n instanceof I.m||n instanceof $.Xs||n instanceof T.hi||n instanceof $.$b){window.alert(n.message);return}s(D(n))};return(0,r.jsx)(B,{exist:!1,partyForm:a,store:n,inoutButton:(0,r.jsx)(N.z,{type:"button",onClick:i,children:"Import"})})},Q=e=>{let{store:n}=e,a=(0,S.useLiveQuery)(()=>n.list(),[]);return(0,r.jsxs)(i.xu,{children:[(0,r.jsx)(w(),{href:{pathname:"/"},children:(0,r.jsx)("a",{children:"戻る"})}),(0,r.jsx)(i.xu,{children:(0,r.jsxs)(E.aV,{children:[(0,r.jsx)(E.HC,{children:(0,r.jsx)(w(),{href:{pathname:"party",query:{name:"__new"}},children:(0,r.jsx)("a",{children:"新しく作る"})})},"party-new"),a&&a.map((e,n)=>(0,r.jsx)(E.HC,{children:(0,r.jsx)(w(),{href:{pathname:"party",query:{name:e}},children:(0,r.jsx)("a",{children:e})})},"party-".concat(n)))]})})]})};var R=()=>{let e=(0,s.useSearchParams)(),n=e.get("name"),[a,o]=(0,t.useState)(null);return((0,t.useEffect)(()=>{(async()=>{let e=await (0,d.h)(),n=await f(e);o(n)})()},[]),a)?n?"__new"===n?(0,r.jsx)(O,{store:a}):(0,r.jsx)(G,{partyName:n,store:a}):(0,r.jsx)(Q,{store:a}):(0,r.jsx)(i.xu,{children:(0,r.jsx)(c.x,{children:"loading..."})})}}},function(e){e.O(0,[905,198,971,774,888,179],function(){return e(e.s=6698)}),_N_E=e.O()}]);